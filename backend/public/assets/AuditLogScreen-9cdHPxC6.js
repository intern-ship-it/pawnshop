import{w as X,u as K,r as i,g as Z,s as ee,j as e,T as $,m as te,d as f,X as ae,y as F,q as se,O as le,B as oe,W as re,R as ne,Q as ie,F as ce,U as de}from"./index-o28qtZ4E.js";import{P as me}from"./PageWrapper-D4uzFYGf.js";import{B as b,m as O,a as ue}from"./proxy-D6mGC7EI.js";import{C as p,I as xe,S as z,M as he}from"./Modal-7Sg338uS.js";import{B as M}from"./Badge-Br48OPWn.js";import{A as L}from"./activity-9x1LZVm2.js";import{C as R}from"./clock-C6f4WYXs.js";import{D as pe}from"./dollar-sign-CXfw5wgV.js";import{F as ge}from"./funnel--zIacCUr.js";import{S as G}from"./square-pen-DhoP9-Gi.js";import{P as _}from"./plus-CQNf_PUI.js";import{T as fe}from"./trash-2-D5yhdYvO.js";import{D as be}from"./download-Bqlh6cxb.js";import{P as je}from"./printer-BXY7LAxL.js";const ve=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],we=X("log-in",ve),B="audit_logs",h={login:{label:"Login",icon:we,color:"blue",category:"auth"},logout:{label:"Logout",icon:ie,color:"zinc",category:"auth"},create:{label:"Create",icon:_,color:"emerald",category:"data"},update:{label:"Update",icon:G,color:"amber",category:"data"},delete:{label:"Delete",icon:fe,color:"red",category:"data"},view:{label:"View",icon:ue,color:"zinc",category:"data"},pledge_create:{label:"New Pledge",icon:_,color:"emerald",category:"transaction"},pledge_update:{label:"Update Pledge",icon:G,color:"amber",category:"transaction"},renewal:{label:"Renewal",icon:ne,color:"blue",category:"transaction"},redemption:{label:"Redemption",icon:re,color:"emerald",category:"transaction"},forfeit:{label:"Forfeit",icon:F,color:"red",category:"transaction"},auction:{label:"Auction Sale",icon:oe,color:"amber",category:"transaction"},settings_change:{label:"Settings Change",icon:le,color:"zinc",category:"system"},override:{label:"Manual Override",icon:$,color:"amber",category:"system"},approval:{label:"Approval",icon:se,color:"emerald",category:"system"},rejection:{label:"Rejection",icon:F,color:"red",category:"system"}},A={auth:{label:"Authentication",color:"blue"},customer:{label:"Customer",color:"emerald"},pledge:{label:"Pledge",color:"amber"},renewal:{label:"Renewal",color:"blue"},redemption:{label:"Redemption",color:"emerald"},inventory:{label:"Inventory",color:"zinc"},auction:{label:"Auction",color:"amber"},settings:{label:"Settings",color:"zinc"},user:{label:"User",color:"blue"}},Ne=()=>{const r=["Admin User","Manager User","Cashier User","Ahmad bin Hassan"],j=[{action:"login",module:"auth",description:"User logged in",details:{ip:"192.168.1.100",browser:"Chrome"}},{action:"pledge_create",module:"pledge",description:"Created new pledge PLG-2024-001234",details:{pledgeId:"PLG-2024-001234",customer:"Siti Aminah",amount:2500}},{action:"renewal",module:"renewal",description:"Processed renewal for PLG-2024-001230",details:{pledgeId:"PLG-2024-001230",interest:75,extensionMonths:1}},{action:"redemption",module:"redemption",description:"Processed redemption for PLG-2024-001225",details:{pledgeId:"PLG-2024-001225",totalPaid:2650,items:2}},{action:"create",module:"customer",description:"Created new customer CUST-001234",details:{customerId:"CUST-001234",name:"Lee Mei Ling",ic:"920315-14-5632"}},{action:"update",module:"customer",description:"Updated customer CUST-001230",details:{customerId:"CUST-001230",field:"phone",oldValue:"012-345 6789",newValue:"012-456 7890"}},{action:"override",module:"pledge",description:"Manual gold price override",details:{pledgeId:"PLG-2024-001235",oldPrice:320,newPrice:315,reason:"Market fluctuation"}},{action:"settings_change",module:"settings",description:"Updated interest rate rules",details:{setting:"interestRules.tier2.rate",oldValue:1.5,newValue:1.8}},{action:"forfeit",module:"auction",description:"Marked pledge as forfeited",details:{pledgeId:"PLG-2024-001200",daysOverdue:45}},{action:"auction",module:"auction",description:"Recorded auction sale",details:{pledgeId:"PLG-2024-001195",salePrice:3200,buyer:"Gold Traders Sdn Bhd"}},{action:"approval",module:"pledge",description:"Approved payout override",details:{pledgeId:"PLG-2024-001236",requestedBy:"Cashier User",amount:5e3}},{action:"delete",module:"user",description:"Deleted user account",details:{userId:"USR005",username:"staff_old"}},{action:"logout",module:"auth",description:"User logged out",details:{sessionDuration:"4h 32m"}}],m=[],v=new Date;for(let c=0;c<50;c++){const d=j[Math.floor(Math.random()*j.length)],u=r[Math.floor(Math.random()*r.length)],w=Math.floor(Math.random()*168),x=new Date(v.getTime()-w*60*60*1e3);m.push({id:`LOG-${String(Date.now()+c).slice(-8)}`,timestamp:x.toISOString(),user:u,userId:`USR00${Math.floor(Math.random()*5)+1}`,action:d.action,module:d.module,description:d.description,details:d.details,ip:`192.168.1.${Math.floor(Math.random()*255)}`})}return m.sort((c,d)=>new Date(d.timestamp)-new Date(c.timestamp))};function Oe(){K();const[r,j]=i.useState([]),[m,v]=i.useState(""),[c,d]=i.useState("all"),[u,w]=i.useState("all"),[x,I]=i.useState("all"),[g,T]=i.useState("all"),[C,E]=i.useState(!1),[l,V]=i.useState(null),[q,D]=i.useState(!1);i.useEffect(()=>{let t=Z(B,null);(!t||t.length===0)&&(t=Ne(),ee(B,t)),j(t)},[]);const W=i.useMemo(()=>[...new Set(r.map(s=>s.user))].sort(),[r]),N=i.useMemo(()=>r.filter(t=>{if(m){const s=m.toLowerCase();if(!(t.description?.toLowerCase().includes(s)||t.user?.toLowerCase().includes(s)||t.id?.toLowerCase().includes(s)||JSON.stringify(t.details)?.toLowerCase().includes(s)))return!1}if(c!=="all"&&t.module!==c||u!=="all"&&t.action!==u||x!=="all"&&t.user!==x)return!1;if(g!=="all"){const s=new Date(t.timestamp),a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(g){case"today":if(s<n)return!1;break;case"week":const o=new Date(n.getTime()-10080*60*1e3);if(s<o)return!1;break;case"month":const S=new Date(n.getTime()-720*60*60*1e3);if(s<S)return!1;break}}return!0}),[r,m,c,u,x,g]),y=i.useMemo(()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate());return{total:r.length,today:r.filter(a=>new Date(a.timestamp)>=s).length,transactions:r.filter(a=>["pledge_create","renewal","redemption","forfeit","auction"].includes(a.action)).length,overrides:r.filter(a=>a.action==="override").length}},[r]),U=t=>new Date(t).toLocaleString("en-MY",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),H=t=>{const s=new Date,a=new Date(t),n=s-a,o=Math.floor(n/(1e3*60)),S=Math.floor(n/(1e3*60*60)),k=Math.floor(n/(1e3*60*60*24));return o<1?"Just now":o<60?`${o}m ago`:S<24?`${S}h ago`:k<7?`${k}d ago`:U(t)},J=t=>{V(t),D(!0)},Y=()=>{const t=[["ID","Timestamp","User","Action","Module","Description","Details"].join(","),...N.map(o=>[o.id,o.timestamp,o.user,o.action,o.module,`"${o.description}"`,`"${JSON.stringify(o.details).replace(/"/g,'""')}"`].join(","))].join(`
`),s=new Blob([t],{type:"text/csv"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`audit_log_${new Date().toISOString().split("T")[0]}.csv`,n.click()},Q=()=>{v(""),d("all"),w("all"),I("all"),T("all")},P=m||c!=="all"||u!=="all"||x!=="all"||g!=="all";return e.jsxs(me,{title:"Audit Log",subtitle:"View system activity and transaction history",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{variant:"outline",leftIcon:be,onClick:Y,children:"Export CSV"}),e.jsx(b,{variant:"outline",leftIcon:je,children:"Print"})]}),children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Total Logs"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:y.total})]})]})}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(R,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Today"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:y.today})]})]})}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Transactions"}),e.jsx("p",{className:"text-xl font-bold text-amber-600",children:y.transactions})]})]})}),e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Overrides"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:y.overrides})]})]})})]}),e.jsxs(p,{className:"p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(xe,{placeholder:"Search logs...",value:m,onChange:t=>v(t.target.value),leftIcon:te})}),e.jsx(z,{value:g,onChange:t=>T(t.target.value),options:[{value:"all",label:"All Time"},{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"}],className:"w-36"}),e.jsxs(b,{variant:"outline",leftIcon:ge,onClick:()=>E(!C),className:f(C&&"bg-zinc-100"),children:["Filters",P&&e.jsx("span",{className:"ml-2 w-5 h-5 rounded-full bg-amber-500 text-white text-xs flex items-center justify-center",children:"!"})]}),P&&e.jsx(b,{variant:"outline",onClick:Q,children:e.jsx(ae,{className:"w-4 h-4"})})]}),C&&e.jsx(O.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-4 pt-4 border-t border-zinc-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(z,{label:"Module",value:c,onChange:t=>d(t.target.value),options:[{value:"all",label:"All Modules"},...Object.entries(A).map(([t,s])=>({value:t,label:s.label}))]}),e.jsx(z,{label:"Action",value:u,onChange:t=>w(t.target.value),options:[{value:"all",label:"All Actions"},...Object.entries(h).map(([t,s])=>({value:t,label:s.label}))]}),e.jsx(z,{label:"User",value:x,onChange:t=>I(t.target.value),options:[{value:"all",label:"All Users"},...W.map(t=>({value:t,label:t}))]})]})})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("p",{className:"text-sm text-zinc-500",children:["Showing ",e.jsx("strong",{children:N.length})," of ",r.length," logs"]})}),e.jsx(p,{className:"overflow-hidden",children:N.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ce,{className:"w-16 h-16 text-zinc-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-zinc-800 mb-2",children:"No Logs Found"}),e.jsx("p",{className:"text-zinc-500",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"divide-y divide-zinc-100",children:N.map((t,s)=>{const a=h[t.action]||{label:t.action,icon:L,color:"zinc"},n=A[t.module]||{label:t.module},o=a.icon;return e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:Math.min(s*.02,.5)},className:"p-4 hover:bg-zinc-50 cursor-pointer transition-colors",onClick:()=>J(t),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:f("w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",a.color==="blue"&&"bg-blue-100",a.color==="emerald"&&"bg-emerald-100",a.color==="amber"&&"bg-amber-100",a.color==="red"&&"bg-red-100",a.color==="zinc"&&"bg-zinc-100"),children:e.jsx(o,{className:f("w-5 h-5",a.color==="blue"&&"text-blue-600",a.color==="emerald"&&"text-emerald-600",a.color==="amber"&&"text-amber-600",a.color==="red"&&"text-red-600",a.color==="zinc"&&"text-zinc-600")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-medium text-zinc-800",children:t.description})}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-zinc-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3.5 h-3.5"}),t.user]}),e.jsx(M,{variant:"secondary",className:"text-xs",children:n.label}),e.jsx("span",{className:"text-zinc-400",children:"â€¢"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3.5 h-3.5"}),H(t.timestamp)]})]})]}),e.jsx(M,{variant:a.color==="emerald"?"success":a.color==="amber"?"warning":a.color==="red"?"error":a.color==="blue"?"info":"secondary",children:a.label})]})},t.id)})})}),e.jsx(he,{isOpen:q,onClose:()=>D(!1),title:"Log Details",size:"md",children:l&&e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[(()=>{const t=h[l.action]||{icon:L,color:"zinc"},s=t.icon;return e.jsx("div",{className:f("w-12 h-12 rounded-xl flex items-center justify-center",t.color==="blue"&&"bg-blue-100",t.color==="emerald"&&"bg-emerald-100",t.color==="amber"&&"bg-amber-100",t.color==="red"&&"bg-red-100",t.color==="zinc"&&"bg-zinc-100"),children:e.jsx(s,{className:f("w-6 h-6",t.color==="blue"&&"text-blue-600",t.color==="emerald"&&"text-emerald-600",t.color==="amber"&&"text-amber-600",t.color==="red"&&"text-red-600",t.color==="zinc"&&"text-zinc-600")})})})(),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-zinc-800",children:l.description}),e.jsx("p",{className:"text-sm text-zinc-500",children:l.id})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between p-3 bg-zinc-50 rounded-lg",children:[e.jsx("span",{className:"text-zinc-500",children:"Timestamp"}),e.jsx("span",{className:"font-medium",children:U(l.timestamp)})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-zinc-50 rounded-lg",children:[e.jsx("span",{className:"text-zinc-500",children:"User"}),e.jsx("span",{className:"font-medium",children:l.user})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-zinc-50 rounded-lg",children:[e.jsx("span",{className:"text-zinc-500",children:"Module"}),e.jsx(M,{variant:"secondary",children:A[l.module]?.label||l.module})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-zinc-50 rounded-lg",children:[e.jsx("span",{className:"text-zinc-500",children:"Action"}),e.jsx(M,{variant:h[l.action]?.color==="emerald"?"success":h[l.action]?.color==="amber"?"warning":h[l.action]?.color==="red"?"error":"info",children:h[l.action]?.label||l.action})]}),l.ip&&e.jsxs("div",{className:"flex justify-between p-3 bg-zinc-50 rounded-lg",children:[e.jsx("span",{className:"text-zinc-500",children:"IP Address"}),e.jsx("span",{className:"font-mono text-sm",children:l.ip})]})]}),l.details&&Object.keys(l.details).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-700 mb-2",children:"Additional Details"}),e.jsx("div",{className:"bg-zinc-900 rounded-lg p-4 overflow-x-auto",children:e.jsx("pre",{className:"text-sm text-emerald-400 font-mono",children:JSON.stringify(l.details,null,2)})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(b,{variant:"outline",fullWidth:!0,onClick:()=>D(!1),children:"Close"})})]})})]})}export{Oe as default};
