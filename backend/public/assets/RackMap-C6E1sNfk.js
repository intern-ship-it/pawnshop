import{w as te,a as ae,u as le,b as ce,r as c,g as C,x as $,j as e,G as E,P as R,d as p,m as ie,R as re,U as ne,q as de,S as v,e as O,s as U}from"./index-o28qtZ4E.js";import{f as oe}from"./formatters-BhAPqf4o.js";import{P as me}from"./PageWrapper-D4uzFYGf.js";import{m as xe,B as n,a as he}from"./proxy-D6mGC7EI.js";import{C as j,I as m,M as L}from"./Modal-7Sg338uS.js";import{B as F}from"./Badge-Br48OPWn.js";import{B as P}from"./box-B3DJ7QKf.js";import{C as ue}from"./clock-C6f4WYXs.js";import{A as q}from"./arrow-right-B_qPtgmv.js";import{M as pe}from"./map-pin-CM4a5Gr_.js";import{P as V}from"./plus-CQNf_PUI.js";import{P as je}from"./printer-BXY7LAxL.js";const ge=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],fe=te("layers",ge),Ne=[{id:"A",name:"Rack A",slots:20,description:"Main gold storage",rows:4,cols:5},{id:"B",name:"Rack B",slots:20,description:"Secondary storage",rows:4,cols:5},{id:"C",name:"Rack C",slots:15,description:"High value items",rows:3,cols:5},{id:"SAFE",name:"Safe",slots:10,description:"Premium/large items",rows:2,cols:5}];function Ee(){const _=ae(),g=le(),{pledges:T}=ce(s=>s.pledges),[d,D]=c.useState([]),[z,W]=c.useState(null),[x,H]=c.useState(null),[S,B]=c.useState(""),[Q,b]=c.useState(!1),[Y,y]=c.useState(!1),[K,k]=c.useState(!1),[a,h]=c.useState({id:"",name:"",slots:20,description:"",rows:4,cols:5}),[f,M]=c.useState("");c.useEffect(()=>{const t=C(v.SETTINGS,{}).racks||Ne;D(t);const l=C(v.PLEDGES,[]);g($(l)),t.length>0&&!z&&W(t[0].id)},[g]);const w=c.useMemo(()=>{const s={};return T.forEach(t=>{if(t.rackLocation&&(t.status==="active"||t.status==="overdue")){const l=t.rackLocation.toUpperCase();s[l]||(s[l]=[]),s[l].push({pledgeId:t.id,pledgeNo:t.pledgeNo||t.id,customerName:t.customerName,status:t.status,itemCount:t.items?.length||0,totalWeight:t.items?.reduce((i,o)=>i+(parseFloat(o.weight)||0),0)||0,loanAmount:t.loanAmount,dueDate:t.dueDate,createdAt:t.createdAt})}}),s},[T]),N=c.useMemo(()=>{const s=d.reduce((i,o)=>i+(o.slots||0),0),t=Object.keys(w).length,l=s-t;return{totalRacks:d.length,totalSlots:s,occupiedSlots:t,emptySlots:l,occupancyRate:s>0?(t/s*100).toFixed(1):0}},[d,w]),r=c.useMemo(()=>d.find(s=>s.id===z)||d[0],[d,z]),u=c.useMemo(()=>{if(!r)return[];const s=[],t=r.rows||4,l=r.cols||5;for(let i=0;i<t;i++)for(let o=0;o<l;o++){const I=i*l+o+1;if(I<=r.slots){const G=`${r.id}-${String(I).padStart(2,"0")}`,A=w[G]||[];s.push({id:G,row:i,col:o,number:I,isOccupied:A.length>0,occupants:A,hasOverdue:A.some(se=>se.status==="overdue")})}}return s},[r,w]),J=c.useMemo(()=>{if(!S)return u;const s=S.toLowerCase();return u.filter(t=>t.id.toLowerCase().includes(s)?!0:t.occupants.some(l=>l.pledgeNo?.toLowerCase().includes(s)||l.customerName?.toLowerCase().includes(s)))},[u,S]),X=s=>{H(s),b(!0)},Z=()=>{if(!a.id||!a.name){g(O({type:"error",title:"Error",message:"Rack ID and Name are required"}));return}const s=[...d,{...a,id:a.id.toUpperCase(),slots:parseInt(a.slots)||20,rows:parseInt(a.rows)||4,cols:parseInt(a.cols)||5}],t=C(v.SETTINGS,{});t.racks=s,U(v.SETTINGS,t),D(s),y(!1),h({id:"",name:"",slots:20,description:"",rows:4,cols:5}),g(O({type:"success",title:"Rack Added",message:`${a.name} has been created`}))},ee=()=>{if(!x||!f)return;const s=x.occupants[0];if(!s)return;const l=C(v.PLEDGES,[]).map(i=>i.id===s.pledgeId?{...i,rackLocation:f.toUpperCase()}:i);U(v.PLEDGES,l),g($(l)),k(!1),b(!1),M(""),g(O({type:"success",title:"Pledge Moved",message:`${s.pledgeNo} moved to ${f.toUpperCase()}`}))};return e.jsxs(me,{title:"Rack / Locker Map",subtitle:"Visual storage location management",actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"outline",leftIcon:je,children:"Print Map"}),e.jsx(n,{variant:"accent",leftIcon:V,onClick:()=>y(!0),children:"Add Rack"})]}),children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Total Racks"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:N.totalRacks})]})]})}),e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-100 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-zinc-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Total Slots"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:N.totalSlots})]})]})}),e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(R,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Occupied"}),e.jsx("p",{className:"text-xl font-bold text-amber-600",children:N.occupiedSlots})]})]})}),e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Empty"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:N.emptySlots})]})]})}),e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-purple-600 font-bold text-sm",children:[N.occupancyRate,"%"]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Occupancy"}),e.jsx("div",{className:"w-20 h-2 bg-zinc-200 rounded-full overflow-hidden mt-1",children:e.jsx("div",{className:"h-full bg-purple-500 rounded-full transition-all",style:{width:`${N.occupancyRate}%`}})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-zinc-800 mb-4 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-amber-500"}),"Racks"]}),e.jsx("div",{className:"space-y-2",children:d.map(s=>{const t=Object.keys(w).filter(i=>i.startsWith(s.id+"-")).length,l=z===s.id;return e.jsxs("button",{onClick:()=>W(s.id),className:p("w-full p-3 rounded-lg border-2 text-left transition-all",l?"border-amber-500 bg-amber-50":"border-zinc-200 hover:border-zinc-300"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-zinc-800",children:s.name}),e.jsx("p",{className:"text-xs text-zinc-500",children:s.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-zinc-800",children:[t,"/",s.slots]}),e.jsx("p",{className:"text-xs text-zinc-400",children:"slots"})]})]}),e.jsx("div",{className:"w-full h-1.5 bg-zinc-200 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:p("h-full rounded-full transition-all",t===s.slots?"bg-red-500":"bg-amber-500"),style:{width:`${t/s.slots*100}%`}})})]},s.id)})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-zinc-200",children:[e.jsx("p",{className:"text-xs font-medium text-zinc-500 mb-3",children:"LEGEND"}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-zinc-100 border border-zinc-300"}),e.jsx("span",{className:"text-zinc-600",children:"Empty Slot"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-amber-500"}),e.jsx("span",{className:"text-zinc-600",children:"Occupied"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-zinc-600",children:"Overdue Item"})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-800",children:r?.name||"Select a Rack"}),e.jsx("p",{className:"text-sm text-zinc-500",children:r?.description})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(m,{placeholder:"Search slot or pledge...",value:S,onChange:s=>B(s.target.value),leftIcon:ie,className:"w-48"})})]}),r?e.jsx("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${r.cols||5}, minmax(0, 1fr))`},children:J.map(s=>e.jsxs(xe.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>X(s),className:p("aspect-square rounded-xl border-2 p-2 transition-all flex flex-col items-center justify-center relative",s.isOccupied?s.hasOverdue?"bg-red-500 border-red-600 text-white":"bg-amber-500 border-amber-600 text-white":"bg-zinc-50 border-zinc-200 hover:border-zinc-300 text-zinc-600"),children:[e.jsx("span",{className:"text-xs font-bold",children:s.id}),s.isOccupied?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-5 h-5 mt-1"}),e.jsx("span",{className:"text-[10px] mt-1 truncate w-full text-center",children:s.occupants[0]?.pledgeNo}),s.occupants.length>1&&e.jsxs("span",{className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-blue-500 text-white text-[10px] flex items-center justify-center",children:["+",s.occupants.length-1]})]}):e.jsx(P,{className:"w-5 h-5 mt-1 text-zinc-300"})]},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-16 h-16 text-zinc-300 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-500",children:"Select a rack to view slots"})]}),r&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-zinc-200 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-zinc-500",children:[e.jsx("strong",{className:"text-zinc-800",children:u.filter(s=>s.isOccupied).length})," occupied"]}),e.jsxs("span",{className:"text-zinc-500",children:[e.jsx("strong",{className:"text-zinc-800",children:u.filter(s=>!s.isOccupied).length})," empty"]}),e.jsxs("span",{className:"text-zinc-500",children:[e.jsx("strong",{className:"text-red-600",children:u.filter(s=>s.hasOverdue).length})," overdue"]})]}),e.jsx(n,{variant:"outline",size:"sm",leftIcon:re,onClick:()=>B(""),children:"Reset View"})]})]})})]}),e.jsx(L,{isOpen:Q,onClose:()=>b(!1),title:`Slot ${x?.id}`,size:"md",children:e.jsxs("div",{className:"p-5",children:[x?.isOccupied?e.jsx(e.Fragment,{children:e.jsx("div",{className:"space-y-3 mb-6",children:x.occupants.map((s,t)=>e.jsxs("div",{className:p("p-4 rounded-xl border",s.status==="overdue"?"bg-red-50 border-red-200":"bg-amber-50 border-amber-200"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:p("w-5 h-5",s.status==="overdue"?"text-red-500":"text-amber-500")}),e.jsx("span",{className:"font-bold",children:s.pledgeNo})]}),e.jsx(F,{variant:s.status==="overdue"?"error":"success",children:s.status==="overdue"?"Overdue":"Active"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-zinc-500 flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"})," Customer"]}),e.jsx("p",{className:"font-medium",children:s.customerName})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-zinc-500 flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"})," Items"]}),e.jsxs("p",{className:"font-medium",children:[s.itemCount," items (",s.totalWeight.toFixed(2),"g)"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500",children:"Loan Amount"}),e.jsx("p",{className:"font-medium text-emerald-600",children:oe(s.loanAmount)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-zinc-500 flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"})," Due Date"]}),e.jsx("p",{className:p("font-medium",s.status==="overdue"&&"text-red-600"),children:s.dueDate?new Date(s.dueDate).toLocaleDateString("en-MY"):"N/A"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(n,{variant:"outline",size:"sm",fullWidth:!0,leftIcon:he,onClick:()=>{b(!1),_(`/pledges/${s.pledgeId}`)},children:"View Pledge"}),e.jsx(n,{variant:"outline",size:"sm",fullWidth:!0,leftIcon:q,onClick:()=>k(!0),children:"Move"})]})]},s.pledgeId))})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-zinc-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(P,{className:"w-8 h-8 text-zinc-400"})}),e.jsx("h4",{className:"font-semibold text-zinc-800 mb-2",children:"Empty Slot"}),e.jsx("p",{className:"text-sm text-zinc-500 mb-4",children:"This slot is available for new items"}),e.jsxs(F,{variant:"success",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Available"]})]}),e.jsx(n,{variant:"outline",fullWidth:!0,onClick:()=>b(!1),className:"mt-4",children:"Close"})]})}),e.jsx(L,{isOpen:K,onClose:()=>k(!1),title:"Move to New Location",size:"sm",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"mb-4 p-3 bg-zinc-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Moving from"}),e.jsx("p",{className:"font-bold text-lg",children:x?.id}),e.jsx("p",{className:"text-sm text-zinc-600",children:x?.occupants[0]?.pledgeNo})]}),e.jsx(m,{label:"New Location",placeholder:"e.g., B-05, SAFE-01",value:f,onChange:s=>M(s.target.value.toUpperCase()),leftIcon:pe}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-zinc-500 mb-2",children:"Available Slots:"}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-24 overflow-y-auto",children:u.filter(s=>!s.isOccupied).slice(0,10).map(s=>e.jsx("button",{onClick:()=>M(s.id),className:p("px-2 py-1 text-xs rounded border transition-colors",f===s.id?"bg-amber-100 border-amber-300 text-amber-700":"border-zinc-200 hover:bg-zinc-50"),children:s.id},s.id))})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(n,{variant:"outline",fullWidth:!0,onClick:()=>k(!1),children:"Cancel"}),e.jsx(n,{variant:"accent",fullWidth:!0,leftIcon:q,onClick:ee,disabled:!f,children:"Move Item"})]})]})}),e.jsx(L,{isOpen:Y,onClose:()=>y(!1),title:"Add New Rack",size:"sm",children:e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsx(m,{label:"Rack ID",placeholder:"e.g., D, E, VAULT",value:a.id,onChange:s=>h({...a,id:s.target.value.toUpperCase()}),maxLength:5,helperText:"Short code (1-5 characters)"}),e.jsx(m,{label:"Rack Name",placeholder:"e.g., Rack D",value:a.name,onChange:s=>h({...a,name:s.target.value})}),e.jsx(m,{label:"Description",placeholder:"e.g., Reserve storage",value:a.description,onChange:s=>h({...a,description:s.target.value})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(m,{label:"Total Slots",type:"number",value:a.slots,onChange:s=>h({...a,slots:s.target.value})}),e.jsx(m,{label:"Rows",type:"number",value:a.rows,onChange:s=>h({...a,rows:s.target.value})}),e.jsx(m,{label:"Columns",type:"number",value:a.cols,onChange:s=>h({...a,cols:s.target.value})})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(n,{variant:"outline",fullWidth:!0,onClick:()=>y(!1),children:"Cancel"}),e.jsx(n,{variant:"accent",fullWidth:!0,leftIcon:V,onClick:Z,children:"Add Rack"})]})]})})]})}export{Ee as default};
