import{a as L,u as B,b as R,r as x,g as O,x as M,j as e,P as b,q as S,T as A,h as V,m as U,y as W,d as $,R as q,z as G,S as H}from"./index-o28qtZ4E.js";import{f as z,a as Q,c as y}from"./formatters-BhAPqf4o.js";import{P as K}from"./PageWrapper-D4uzFYGf.js";import{m as c,B as r,a as X}from"./proxy-D6mGC7EI.js";import{C as o,I as Y,S as g}from"./Modal-7Sg338uS.js";import{B as _}from"./Badge-Br48OPWn.js";import{D as P}from"./dollar-sign-CXfw5wgV.js";import{S as J}from"./scale-DaJuZKuB.js";import{D as Z}from"./download-Bqlh6cxb.js";import{P as ee}from"./plus-CQNf_PUI.js";const C={active:{label:"Active",variant:"success",icon:S},overdue:{label:"Overdue",variant:"error",icon:A},redeemed:{label:"Redeemed",variant:"info",icon:P},forfeited:{label:"Forfeited",variant:"warning",icon:W},auctioned:{label:"Auctioned",variant:"default",icon:b}};function me(){const h=L(),j=B(),{pledges:i}=R(t=>t.pledges),[u,w]=x.useState(""),[v,I]=x.useState("all"),[N,k]=x.useState("all"),[D,E]=x.useState("newest");x.useEffect(()=>{const t=O(H.PLEDGES,[]),s=new Date,a=t.map(l=>l.status==="active"&&new Date(l.dueDate)<s?{...l,status:"overdue"}:l);j(M(a))},[j]);const d={total:i.length,active:i.filter(t=>t.status==="active").length,overdue:i.filter(t=>t.status==="overdue").length,totalValue:i.filter(t=>t.status==="active"||t.status==="overdue").reduce((t,s)=>t+(s.loanAmount||0),0),redeemed:i.filter(t=>t.status==="redeemed").length},f=i.filter(t=>{if(u){const s=u.toLowerCase(),a=t.id?.toLowerCase().includes(s),l=t.customerName?.toLowerCase().includes(s),n=t.customerIC?.replace(/[-\s]/g,"").includes(s.replace(/[-\s]/g,""));if(!a&&!l&&!n)return!1}if(v!=="all"&&t.status!==v)return!1;if(N!=="all"){const s=new Date(t.createdAt),a=new Date;switch(N){case"today":if(s.toDateString()!==a.toDateString())return!1;break;case"week":const l=new Date(a.setDate(a.getDate()-7));if(s<l)return!1;break;case"month":const n=new Date(a.setMonth(a.getMonth()-1));if(s<n)return!1;break}}return!0}).sort((t,s)=>{switch(D){case"newest":return new Date(s.createdAt)-new Date(t.createdAt);case"oldest":return new Date(t.createdAt)-new Date(s.createdAt);case"amount-high":return(s.loanAmount||0)-(t.loanAmount||0);case"amount-low":return(t.loanAmount||0)-(s.loanAmount||0);case"due-soon":return new Date(t.dueDate)-new Date(s.dueDate);default:return 0}}),F=t=>{const s=new Date,a=new Date(t);return Math.ceil((a-s)/(1e3*60*60*24))},T={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},m={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e.jsxs(K,{title:"Pledges",subtitle:"Manage all pledge transactions",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r,{variant:"outline",leftIcon:Z,children:"Export"}),e.jsx(r,{variant:"accent",leftIcon:ee,onClick:()=>h("/pledges/new"),children:"New Pledge"})]}),children:[e.jsxs(c.div,{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",variants:T,initial:"hidden",animate:"visible",children:[e.jsx(c.div,{variants:m,children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-100 flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-zinc-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Total Pledges"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:d.total})]})]})})}),e.jsx(c.div,{variants:m,children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Active"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:d.active})]})]})})}),e.jsx(c.div,{variants:m,children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Overdue"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:d.overdue})]})]})})}),e.jsx(c.div,{variants:m,children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Outstanding"}),e.jsx("p",{className:"text-xl font-bold text-amber-600",children:z(d.totalValue)})]})]})})}),e.jsx(c.div,{variants:m,children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Redeemed"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:d.redeemed})]})]})})})]}),e.jsx(o,{className:"p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Y,{placeholder:"Search by Pledge ID, Customer Name or IC...",value:u,onChange:t=>w(t.target.value),leftIcon:U})}),e.jsx(g,{value:v,onChange:t=>I(t.target.value),options:[{value:"all",label:"All Status"},{value:"active",label:"Active"},{value:"overdue",label:"Overdue"},{value:"redeemed",label:"Redeemed"},{value:"forfeited",label:"Forfeited"}],className:"w-40"}),e.jsx(g,{value:N,onChange:t=>k(t.target.value),options:[{value:"all",label:"All Time"},{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"}],className:"w-40"}),e.jsx(g,{value:D,onChange:t=>E(t.target.value),options:[{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"amount-high",label:"Amount: High to Low"},{value:"amount-low",label:"Amount: Low to High"},{value:"due-soon",label:"Due Soon"}],className:"w-44"})]})}),e.jsxs(o,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-zinc-200 bg-zinc-50",children:[e.jsx("th",{className:"text-left p-4 text-sm font-semibold text-zinc-600",children:"Pledge ID"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold text-zinc-600",children:"Customer"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold text-zinc-600",children:"Items"}),e.jsx("th",{className:"text-right p-4 text-sm font-semibold text-zinc-600",children:"Loan Amount"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold text-zinc-600",children:"Created"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold text-zinc-600",children:"Due Date"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold text-zinc-600",children:"Status"}),e.jsx("th",{className:"text-center p-4 text-sm font-semibold text-zinc-600",children:"Actions"})]})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"p-8 text-center",children:[e.jsx(b,{className:"w-12 h-12 text-zinc-300 mx-auto mb-3"}),e.jsx("p",{className:"text-zinc-500",children:"No pledges found"}),u&&e.jsx(r,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>w(""),children:"Clear Search"})]})}):f.map((t,s)=>{const a=C[t.status]||C.active,l=a.icon,n=F(t.dueDate);return e.jsxs(c.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"border-b border-zinc-100 hover:bg-zinc-50 cursor-pointer transition-colors",onClick:()=>h(`/pledges/${t.id}`),children:[e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"font-mono font-semibold text-zinc-800",children:t.id})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white text-sm font-medium",children:t.customerName?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-zinc-800",children:t.customerName}),e.jsx("p",{className:"text-xs text-zinc-500 font-mono",children:Q(t.customerIC)})]})]})}),e.jsxs("td",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-zinc-400"}),e.jsxs("span",{className:"text-zinc-600",children:[t.items?.length||0," item(s)"]})]}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[t.totalWeight?.toFixed(2),"g"]})]}),e.jsx("td",{className:"p-4 text-right",children:e.jsx("span",{className:"font-semibold text-zinc-800",children:z(t.loanAmount)})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"text-zinc-600 text-sm",children:y(t.createdAt)})}),e.jsxs("td",{className:"p-4",children:[e.jsx("span",{className:"text-zinc-600 text-sm",children:y(t.dueDate)}),t.status==="active"&&e.jsx("p",{className:$("text-xs mt-0.5",n<=7?"text-red-500":n<=30?"text-amber-500":"text-zinc-400"),children:n>0?`${n} days left`:"Due today"})]}),e.jsx("td",{className:"p-4",children:e.jsxs(_,{variant:a.variant,children:[e.jsx(l,{className:"w-3 h-3 mr-1"}),a.label]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(r,{variant:"ghost",size:"icon-sm",onClick:p=>{p.stopPropagation(),h(`/pledges/${t.id}`)},children:e.jsx(X,{className:"w-4 h-4"})}),(t.status==="active"||t.status==="overdue")&&e.jsx(r,{variant:"ghost",size:"icon-sm",onClick:p=>{p.stopPropagation(),j(G(t)),h("/renewals")},children:e.jsx(q,{className:"w-4 h-4"})})]})})]},t.id)})})]})}),f.length>0&&e.jsxs("div",{className:"p-4 border-t border-zinc-200 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-zinc-500",children:["Showing ",f.length," of ",i.length," pledges"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",disabled:!0,children:"Previous"}),e.jsx(r,{variant:"outline",size:"sm",disabled:!0,children:"Next"})]})]})]})]})}export{me as default};
