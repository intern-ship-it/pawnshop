import{w as z,u as Y,b as Z,r as n,g as S,x as J,j as e,P as ee,q as f,y as C,T as N,A as se,d as $,S as P,e as u,s as te}from"./index-o28qtZ4E.js";import{P as ae}from"./PageWrapper-D4uzFYGf.js";import{B as x,m as O}from"./proxy-D6mGC7EI.js";import{C as d,S as ce,I as ne,M as U}from"./Modal-7Sg338uS.js";import{B as L}from"./Badge-Br48OPWn.js";import{M as ie}from"./map-pin-CM4a5Gr_.js";import{Q as _}from"./qr-code-CJ14BqF9.js";import{B as le,R as re}from"./rotate-ccw-D7q9mWgT.js";import{C as de}from"./clock-C6f4WYXs.js";import{A as oe}from"./index-B9GDT2Wk.js";import{C as me}from"./check-DGHPnJ4E.js";const xe=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],he=z("play",xe);const pe=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],k=z("scan-line",pe);const je=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],ue=z("zap",je);function Ie(){const h=Y(),{pledges:I}=Z(s=>s.pledges),M=n.useRef(null),[l,V]=n.useState("all"),[j,R]=n.useState(!1),[A,g]=n.useState(""),[i,v]=n.useState([]),[w,D]=n.useState(null),[W,b]=n.useState(!1),[F,y]=n.useState(!1),[E,q]=n.useState("");n.useEffect(()=>{const s=S(P.PLEDGES,[]);h(J(s))},[h]);const G=n.useMemo(()=>S(P.SETTINGS,{}).racks||[{id:"A",name:"Rack A"},{id:"B",name:"Rack B"},{id:"C",name:"Rack C"}],[]),p=n.useMemo(()=>{const s=[];return I.forEach(a=>{if(a.status==="active"||a.status==="overdue"){const c=a.rackLocation?.toUpperCase()||"";if(l!=="all"&&!c.startsWith(l+"-")&&c!==l)return;(a.items||[]).forEach((o,r)=>{s.push({barcode:o.barcode||`${a.id}-${r+1}`,pledgeId:a.id,pledgeNo:a.pledgeNo||a.id,category:o.category,weight:o.weight,purity:o.purity,rackLocation:c,customerName:a.customerName})})}}),s},[I,l]),t=n.useMemo(()=>{const s=new Set(i.map(m=>m.barcode)),a=new Set(p.map(m=>m.barcode)),c=i.filter(m=>a.has(m.barcode)),o=i.filter(m=>!a.has(m.barcode)),r=p.filter(m=>!s.has(m.barcode));return{expected:p.length,scanned:i.length,matched:c.length,unexpected:o.length,missing:r.length,matchedItems:c,unexpectedItems:o,missingItems:r,progress:p.length>0?Math.round(c.length/p.length*100):0}},[i,p]),Q=()=>{R(!0),D(new Date),v([]),setTimeout(()=>M.current?.focus(),100),h(u({type:"info",title:"Reconciliation Started",message:`Scanning ${t.expected} items in ${l==="all"?"all racks":l}`}))},T=s=>{s?.preventDefault();const a=A.trim().toUpperCase();if(!a)return;if(i.find(r=>r.barcode===a)){h(u({type:"warning",title:"Duplicate",message:"Item already scanned"})),g("");return}const c=p.find(r=>r.barcode===a),o={barcode:a,timestamp:new Date().toISOString(),status:c?"matched":"unexpected",...c||{}};v(r=>[o,...r]),g(""),h(c?u({type:"success",title:"Matched",message:a}):u({type:"error",title:"Unexpected Item",message:`${a} not in expected list`}))},H=()=>{const s=p.filter(a=>!i.find(c=>c.barcode===a.barcode));if(s.length>0){const a=s[Math.floor(Math.random()*s.length)];g(a.barcode),setTimeout(()=>T(),100)}else h(u({type:"info",title:"Complete",message:"All items have been scanned"}))},B=()=>{R(!1),v([]),D(null),g("")},K=()=>{const s=S("reconciliations",[]),a={id:`RECON-${Date.now()}`,date:new Date().toISOString(),rack:l,startTime:w?.toISOString(),endTime:new Date().toISOString(),expected:t.expected,scanned:t.scanned,matched:t.matched,missing:t.missing,unexpected:t.unexpected,status:t.missing>0||t.unexpected>0?"discrepancy":"complete",note:E,performedBy:"Admin User"};te("reconciliations",[...s,a]),b(!1),B(),h(u({type:"success",title:"Reconciliation Complete",message:t.missing===0&&t.unexpected===0?"All items verified successfully":`Completed with ${t.missing+t.unexpected} discrepancies`}))},X=()=>{if(!w)return"00:00";const s=Math.floor((new Date-w)/1e3),a=Math.floor(s/60),c=s%60;return`${String(a).padStart(2,"0")}:${String(c).padStart(2,"0")}`};return e.jsxs(ae,{title:"Stock Reconciliation",subtitle:"Verify physical inventory against system records",actions:e.jsx("div",{className:"flex items-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"outline",leftIcon:re,onClick:B,children:"Reset"}),e.jsx(x,{variant:"accent",leftIcon:f,onClick:()=>b(!0),disabled:t.scanned===0,children:"Complete"})]}):e.jsx(x,{variant:"accent",leftIcon:he,onClick:Q,children:"Start Reconciliation"})}),children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(ee,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Expected"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:t.expected})]})]})}),e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Scanned"}),e.jsx("p",{className:"text-xl font-bold text-amber-600",children:t.scanned})]})]})}),e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(f,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Matched"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:t.matched})]})]})}),e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(C,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Missing"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:t.missing})]})]})}),e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Unexpected"}),e.jsx("p",{className:"text-xl font-bold text-orange-600",children:t.unexpected})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-zinc-800 mb-4 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-amber-500"}),"Select Area"]}),e.jsx(ce,{value:l,onChange:s=>V(s.target.value),options:[{value:"all",label:"All Racks"},...G.map(s=>({value:s.id,label:s.name}))],disabled:j}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-2",children:[t.expected," items to verify in ",l==="all"?"all racks":l]})]}),e.jsxs(d,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-zinc-800 mb-4 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-amber-500"}),"Barcode Scanner"]}),j?e.jsxs("form",{onSubmit:T,children:[e.jsx(ne,{ref:M,placeholder:"Scan barcode...",value:A,onChange:s=>g(s.target.value.toUpperCase()),leftIcon:le,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(x,{type:"submit",variant:"accent",fullWidth:!0,leftIcon:k,children:"Verify"}),e.jsx(x,{type:"button",variant:"outline",onClick:H,title:"Demo: Scan random item",children:e.jsx(ue,{className:"w-4 h-4"})})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(_,{className:"w-12 h-12 text-zinc-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-zinc-500",children:'Click "Start Reconciliation" to begin'})]}),j&&e.jsx("div",{className:"mt-4 pt-4 border-t border-zinc-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-zinc-500 flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"})," Elapsed"]}),e.jsx("span",{className:"font-mono font-bold text-zinc-800",children:X()})]})})]}),j&&e.jsxs(d,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-zinc-800 mb-4",children:"Progress"}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-zinc-500",children:"Verified"}),e.jsxs("span",{className:"font-medium",children:[t.progress,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-zinc-200 rounded-full overflow-hidden",children:e.jsx(O.div,{className:"h-full bg-gradient-to-r from-amber-500 to-emerald-500 rounded-full",initial:{width:0},animate:{width:`${t.progress}%`},transition:{duration:.5}})})]}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[t.matched," of ",t.expected," items verified"]})]}),j&&t.missing>0&&e.jsx(d,{className:"p-4 bg-red-50 border-red-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-red-800",children:[t.missing," Missing Items"]}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:"Some items haven't been scanned yet."}),e.jsx(x,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>y(!0),children:"View Missing Items"})]})]})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(d,{className:"h-full",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-zinc-800 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-amber-500"}),"Scanned Items"]}),i.length>0&&e.jsxs(L,{variant:"info",children:[i.length," items"]})]}),e.jsx("div",{className:"p-4 max-h-[500px] overflow-y-auto",children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-zinc-200 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-500",children:"No items scanned yet"}),e.jsx("p",{className:"text-sm text-zinc-400 mt-1",children:j?"Scan barcodes to verify items":"Start reconciliation to begin"})]}):e.jsx("div",{className:"space-y-2",children:e.jsx(oe,{children:i.map((s,a)=>e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:$("flex items-center justify-between p-3 rounded-lg border",s.status==="matched"?"bg-emerald-50 border-emerald-200":"bg-orange-50 border-orange-200"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.status==="matched"?e.jsx(f,{className:"w-5 h-5 text-emerald-500"}):e.jsx(N,{className:"w-5 h-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("code",{className:"font-mono text-sm font-medium",children:s.barcode}),s.category&&e.jsxs("p",{className:"text-xs text-zinc-500",children:[s.category," • ",s.pledgeNo]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{variant:s.status==="matched"?"success":"warning",children:s.status==="matched"?"Matched":"Unexpected"}),e.jsx("span",{className:"text-xs text-zinc-400",children:new Date(s.timestamp).toLocaleTimeString()})]})]},s.barcode))})})})]})})]}),e.jsx(U,{isOpen:W,onClose:()=>b(!1),title:"Complete Reconciliation",size:"md",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-emerald-50 rounded-xl",children:[e.jsx(f,{className:"w-8 h-8 text-emerald-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:t.matched}),e.jsx("p",{className:"text-xs text-emerald-700",children:"Matched"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-xl",children:[e.jsx(C,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.missing}),e.jsx("p",{className:"text-xs text-red-700",children:"Missing"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-xl",children:[e.jsx(N,{className:"w-8 h-8 text-orange-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:t.unexpected}),e.jsx("p",{className:"text-xs text-orange-700",children:"Unexpected"})]})]}),e.jsx("div",{className:$("p-4 rounded-xl mb-6",t.missing===0&&t.unexpected===0?"bg-emerald-50 border border-emerald-200":"bg-red-50 border border-red-200"),children:e.jsx("div",{className:"flex items-center gap-3",children:t.missing===0&&t.unexpected===0?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-6 h-6 text-emerald-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-emerald-800",children:"All Items Verified"}),e.jsx("p",{className:"text-sm text-emerald-600",children:"No discrepancies found"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-6 h-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800",children:"Discrepancies Found"}),e.jsxs("p",{className:"text-sm text-red-600",children:[t.missing," missing, ",t.unexpected," unexpected items"]})]})]})})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-zinc-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",rows:3,placeholder:"Add any notes about this reconciliation...",value:E,onChange:s=>q(s.target.value)})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{variant:"outline",fullWidth:!0,onClick:()=>b(!1),children:"Cancel"}),e.jsx(x,{variant:"accent",fullWidth:!0,leftIcon:me,onClick:K,children:"Complete & Save"})]})]})}),e.jsx(U,{isOpen:F,onClose:()=>y(!1),title:"Missing Items",size:"md",children:e.jsxs("div",{className:"p-5",children:[e.jsx("div",{className:"p-3 bg-red-50 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm text-red-700",children:[e.jsx("strong",{children:t.missing})," items have not been scanned yet"]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:t.missingItems.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-zinc-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-4 h-4 text-red-400"}),e.jsxs("div",{children:[e.jsx("code",{className:"font-mono text-sm",children:s.barcode}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[s.category," • ",s.rackLocation]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-medium",children:s.pledgeNo}),e.jsx("p",{className:"text-xs text-zinc-400",children:s.customerName})]})]},s.barcode))}),e.jsx(x,{variant:"outline",fullWidth:!0,className:"mt-4",onClick:()=>y(!1),children:"Close"})]})})]})}export{Ie as default};
