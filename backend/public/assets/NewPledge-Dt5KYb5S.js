import{w as Te,a as it,u as ct,b as ve,r,g as H,k as ye,j as e,U as Fe,P as te,W as D,d as y,m as dt,X as we,v as ze,h as ot,C as mt,R as xt,q as ht,e as u,S as M,s as Ce,x as ut,n as pt}from"./index-o28qtZ4E.js";import{a as J,b as Se,f as n}from"./formatters-BhAPqf4o.js";import{v as gt}from"./validators-DzCKJgm6.js";import{P as bt}from"./PageWrapper-D4uzFYGf.js";import{m as b,B as p}from"./proxy-D6mGC7EI.js";import{C as ft,I as N,S as Q,M as jt}from"./Modal-7Sg338uS.js";import{B as Nt}from"./Badge-Br48OPWn.js";import{C as Pe}from"./check-DGHPnJ4E.js";import{A as Ie}from"./index-B9GDT2Wk.js";import{C as vt}from"./credit-card-CogcOOr3.js";import{P as Z}from"./plus-CQNf_PUI.js";import{T as yt}from"./trash-2-D5yhdYvO.js";import{D as wt}from"./dollar-sign-CXfw5wgV.js";import{S as zt}from"./scale-DaJuZKuB.js";import{C as Ct}from"./camera-BqlqEqVf.js";import{C as St}from"./clock-C6f4WYXs.js";import{B as ke}from"./building-2-xsKCLuU5.js";import{A as Me}from"./arrow-left-Bj3muJoB.js";import{A as Pt}from"./arrow-right-B_qPtgmv.js";import{P as It}from"./printer-BXY7LAxL.js";import{M as kt}from"./message-square-DD02v1BD.js";const Mt=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],se=Te("calculator",Mt);const Dt=[["path",{d:"m18.226 5.226-2.52-2.52A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-.351",key:"1k2beg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]],Ve=Te("file-pen-line",Dt),De=[{id:1,title:"Customer",icon:Fe,description:"Select customer"},{id:2,title:"Items",icon:te,description:"Add items"},{id:3,title:"Valuation",icon:se,description:"Calculate value"},{id:4,title:"Payout",icon:D,description:"Payment method"},{id:5,title:"Confirm",icon:Ve,description:"Review & sign"}],Ae=[{value:"chain",label:"Chain (Rantai)"},{value:"bangle",label:"Bangle (Gelang)"},{value:"ring",label:"Ring (Cincin)"},{value:"earring",label:"Earring (Anting)"},{value:"pendant",label:"Pendant (Loket)"},{value:"bracelet",label:"Bracelet (Gelang Tangan)"},{value:"necklace",label:"Necklace (Kalung)"},{value:"bar",label:"Gold Bar (Jongkong)"},{value:"coin",label:"Gold Coin (Syiling)"},{value:"other",label:"Other (Lain-lain)"}],Re=[{value:"999",label:"999 (24K)",priceKey:"price999"},{value:"916",label:"916 (22K)",priceKey:"price916"},{value:"875",label:"875 (21K)",priceKey:"price875"},{value:"750",label:"750 (18K)",priceKey:"price750"}],At=[80,70,60],ee={id:"",category:"",description:"",weight:"",purity:"916",pricePerGram:"",stoneDeduction:"",stoneDeductionType:"amount",photo:null};function es(){const E=it(),i=ct(),{selectedCustomer:A,customers:Le}=ve(t=>t.customers),{goldPrice:G}=ve(t=>t.ui),P=r.useRef(null),ae=r.useRef({}),[h,q]=r.useState(1),[R,B]=r.useState(""),[We,le]=r.useState(!1),[o,T]=r.useState(null),[Ee,U]=r.useState(null),[f,F]=r.useState([{...ee,id:"item-1"}]),[ne,Ge]=r.useState(70),[re,qe]=r.useState(""),[V,ie]=r.useState(!1),[m,Be]=r.useState("cash"),[w,O]=r.useState(""),[z,K]=r.useState(""),[L,Ue]=r.useState(""),[W,Oe]=r.useState(""),[ce,Ke]=r.useState(""),[$,Y]=r.useState(null),[de,oe]=r.useState(!1),[me,xe]=r.useState(!1),[$e,he]=r.useState(!1),[Ye,ue]=r.useState(!1),[pe,_e]=r.useState(null);r.useEffect(()=>{const t=H(M.CUSTOMERS,[]);i(ye(t)),A&&(T(A),B(A.icNumber))},[i,A]),r.useEffect(()=>{h===5&&setTimeout(()=>{be()},100)},[h]);const _=t=>{const a=Re.find(s=>s.value===t);return G[a?.priceKey]||G.price916},C=t=>{if(!t.weight||!t.purity)return{gross:0,deduction:0,net:0,priceUsed:0};const a=parseFloat(t.weight)||0,s=_(t.purity),l=t.pricePerGram?parseFloat(t.pricePerGram):s,d=a*l;let j=0;if(t.stoneDeduction){const k=parseFloat(t.stoneDeduction)||0;t.stoneDeductionType==="percent"?j=d*(k/100):j=k}const Ne=Math.max(0,d-j);return{gross:d,deduction:j,net:Ne,priceUsed:l}},x=f.reduce((t,a)=>{const{gross:s,deduction:l,net:d}=C(a);return{grossValue:t.grossValue+s,totalDeduction:t.totalDeduction+l,netValue:t.netValue+d,totalWeight:t.totalWeight+(parseFloat(a.weight)||0)}},{grossValue:0,totalDeduction:0,netValue:0,totalWeight:0}),S=V?parseFloat(re)||0:ne,c=x.netValue*(S/100),ge=()=>{const t=R.replace(/[-\s]/g,"");if(!t){i(u({type:"warning",title:"Required",message:"Please enter IC number"}));return}if(!gt(t)){i(u({type:"error",title:"Invalid IC",message:"Please enter valid 12-digit IC"}));return}le(!0),setTimeout(()=>{const a=Le.find(s=>s.icNumber.replace(/[-\s]/g,"")===t);U(a||"not_found"),a&&(T(a),i(u({type:"success",title:"Found",message:`Customer: ${a.name}`}))),le(!1)},500)},Xe=()=>{const t={...ee,id:`item-${Date.now()}`};F([...f,t])},He=t=>{if(f.length===1){i(u({type:"warning",title:"Required",message:"At least one item is required"}));return}F(f.filter(a=>a.id!==t))},v=(t,a,s)=>{F(f.map(l=>l.id===t?{...l,[a]:s}:l))},Je=(t,a)=>{const s=t.target.files?.[0];if(!s)return;if(!s.type.startsWith("image/")){i(u({type:"error",title:"Invalid",message:"Please upload an image"}));return}const l=new FileReader;l.onloadend=()=>{v(a,"photo",l.result)},l.readAsDataURL(s)};r.useEffect(()=>{m==="cash"?(O(c.toFixed(2)),K("")):m==="transfer"&&(K(c.toFixed(2)),O(""))},[m,c]);const be=()=>{const t=P.current;if(!t)return;const a=t.getContext("2d");a.fillStyle="#ffffff",a.fillRect(0,0,t.width,t.height),a.strokeStyle="#1f2937",a.lineWidth=2,a.lineCap="round"},fe=t=>{const a=P.current;if(!a)return;oe(!0);const s=a.getContext("2d"),l=a.getBoundingClientRect(),d=(t.clientX||t.touches?.[0]?.clientX)-l.left,j=(t.clientY||t.touches?.[0]?.clientY)-l.top;s.beginPath(),s.moveTo(d,j)},je=t=>{if(!de)return;const a=P.current;if(!a)return;const s=a.getContext("2d"),l=a.getBoundingClientRect(),d=(t.clientX||t.touches?.[0]?.clientX)-l.left,j=(t.clientY||t.touches?.[0]?.clientY)-l.top;s.lineTo(d,j),s.stroke()},X=()=>{if(de){oe(!1);const t=P.current;t&&Y(t.toDataURL())}},Qe=()=>{Y(null),be()},Ze=t=>{switch(t){case 1:return o?!0:(i(u({type:"error",title:"Required",message:"Please select a customer"})),!1);case 2:return f.filter(s=>s.category&&s.weight&&parseFloat(s.weight)>0).length===0?(i(u({type:"error",title:"Required",message:"Please add at least one item with category and weight"})),!1):!0;case 3:return S<=0||S>100?(i(u({type:"error",title:"Invalid",message:"Loan percentage must be between 1-100%"})),!1):!0;case 4:if(m==="partial"){const s=parseFloat(w)||0,l=parseFloat(z)||0;if(Math.abs(s+l-c)>.01)return i(u({type:"error",title:"Mismatch",message:"Cash + Transfer must equal loan amount"})),!1;if(l>0&&(!L||!W))return i(u({type:"error",title:"Required",message:"Bank details required for transfer"})),!1}return m==="transfer"&&(!L||!W)?(i(u({type:"error",title:"Required",message:"Bank details required for transfer"})),!1):!0;case 5:return!0;default:return!0}},et=()=>{Ze(h)&&q(h+1)},tt=()=>{h>1&&q(h-1)},st=()=>{if(!$){i(u({type:"error",title:"Required",message:"Customer signature is required"}));return}if(!me){i(u({type:"error",title:"Required",message:"Please agree to terms and conditions"}));return}he(!0),setTimeout(()=>{const t=H(M.PLEDGES,[]),a=String(t.length+1).padStart(4,"0"),s=`PLG-${new Date().getFullYear()}-${a}`,l=f.filter(g=>g.category&&g.weight).map((g,at)=>{const{gross:lt,deduction:nt,net:rt}=C(g);return{...g,barcode:`${s}-${String(at+1).padStart(2,"0")}`,grossValue:lt,deduction:nt,netValue:rt}}),d={id:s,customerId:o.id,customerName:o.name,customerIC:o.icNumber,customerPhone:o.phone,items:l,totalWeight:x.totalWeight,grossValue:x.grossValue,totalDeduction:x.totalDeduction,netValue:x.netValue,loanPercentage:S,loanAmount:c,payoutMethod:m,cashAmount:parseFloat(w)||0,transferAmount:parseFloat(z)||0,bankName:L,accountNumber:W,referenceNo:ce,goldPriceUsed:{...G},signature:$,status:"active",rackLocation:null,createdAt:new Date().toISOString(),dueDate:new Date(Date.now()+4320*60*60*1e3).toISOString(),renewals:[],interestRate:.5},j=[...t,d];Ce(M.PLEDGES,j),i(ut(j));const k=H(M.CUSTOMERS,[]).map(g=>g.id===o.id?{...g,activePledges:(g.activePledges||0)+1,totalPledges:(g.totalPledges||0)+1,totalAmount:(g.totalAmount||0)+c,lastVisit:new Date().toISOString().split("T")[0]}:g);Ce(M.CUSTOMERS,k),i(ye(k)),i(pt(null)),_e(s),he(!1),ue(!0)},1e3)},I={hidden:{opacity:0,x:50},visible:{opacity:1,x:0},exit:{opacity:0,x:-50}};return e.jsxs(bt,{title:"New Pledge",subtitle:"Create a new pledge transaction",actions:e.jsx(p,{variant:"outline",leftIcon:Me,onClick:()=>E("/pledges"),children:"Cancel"}),children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:De.map((t,a)=>{const s=t.icon,l=h===t.id,d=h>t.id;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs(b.div,{className:"flex flex-col items-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:a*.1},children:[e.jsx(b.div,{className:y("w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all",l&&"border-amber-500 bg-amber-50 text-amber-600",d&&"border-emerald-500 bg-emerald-500 text-white",!l&&!d&&"border-zinc-300 bg-white text-zinc-400"),whileHover:{scale:1.05},whileTap:{scale:.95},children:d?e.jsx(Pe,{className:"w-5 h-5"}):e.jsx(s,{className:"w-5 h-5"})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("p",{className:y("text-sm font-medium",l&&"text-amber-600",d&&"text-emerald-600",!l&&!d&&"text-zinc-400"),children:t.title}),e.jsx("p",{className:"text-xs text-zinc-500 hidden sm:block",children:t.description})]})]}),a<De.length-1&&e.jsx("div",{className:y("w-12 lg:w-20 h-0.5 mx-2",d?"bg-emerald-500":"bg-zinc-200")})]},t.id)})})}),e.jsxs(ft,{className:"max-w-4xl mx-auto",children:[e.jsxs(Ie,{mode:"wait",children:[h===1&&e.jsxs(b.div,{variants:I,initial:"hidden",animate:"visible",exit:"exit",className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-800",children:"Customer Information"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Search by IC or select existing customer"})]})]}),e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(N,{placeholder:"Enter IC Number (e.g., 880515-14-5678)",value:R,onChange:t=>B(t.target.value),onKeyDown:t=>t.key==="Enter"&&ge(),leftIcon:vt})}),e.jsx(p,{variant:"primary",leftIcon:dt,onClick:ge,loading:We,children:"Search"})]}),e.jsxs(Ie,{children:[o&&e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"p-4 bg-emerald-50 border border-emerald-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white font-bold text-xl",children:o.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-zinc-800",children:o.name}),e.jsx(Nt,{variant:"success",children:"Selected"})]}),e.jsx("p",{className:"text-sm text-zinc-500 font-mono",children:J(o.icNumber)}),e.jsx("p",{className:"text-sm text-zinc-500",children:Se(o.phone)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Active Pledges"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:o.activePledges||0})]}),e.jsx(p,{variant:"ghost",size:"icon-sm",onClick:()=>{T(null),U(null)},children:e.jsx(we,{className:"w-4 h-4"})})]})}),Ee==="not_found"&&!o&&e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"w-5 h-5 text-amber-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-amber-800",children:"Customer not found"}),e.jsxs("p",{className:"text-sm text-amber-600",children:["IC ",J(R)," is not registered"]})]}),e.jsx(p,{variant:"accent",size:"sm",leftIcon:Z,onClick:()=>E(`/customers/new?ic=${R.replace(/[-\s]/g,"")}`),children:"Create New"})]})})]})]},"step-1"),h===2&&e.jsxs(b.div,{variants:I,initial:"hidden",animate:"visible",exit:"exit",className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-800",children:"Pledge Items"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Add gold items for this pledge"})]})]}),e.jsx(p,{variant:"outline",leftIcon:Z,onClick:Xe,children:"Add Item"})]}),e.jsx("div",{className:"space-y-4",children:f.map((t,a)=>e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 border border-zinc-200 rounded-xl bg-zinc-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-sm font-semibold text-zinc-700",children:["Item #",a+1]}),e.jsx(p,{variant:"ghost",size:"icon-sm",onClick:()=>He(t.id),className:"text-red-500 hover:text-red-600 hover:bg-red-50",children:e.jsx(yt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(Q,{label:"Category",value:t.category,onChange:s=>v(t.id,"category",s.target.value),options:[{value:"",label:"Select..."},...Ae],required:!0}),e.jsx(Q,{label:"Purity",value:t.purity,onChange:s=>{v(t.id,"purity",s.target.value),v(t.id,"pricePerGram","")},options:Re}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-zinc-700 mb-1.5",children:["Price/g (RM) ",e.jsx("span",{className:"text-amber-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{type:"number",step:"0.01",min:"0",placeholder:_(t.purity).toFixed(2),value:t.pricePerGram,onChange:s=>v(t.id,"pricePerGram",s.target.value),leftIcon:wt}),!t.pricePerGram&&e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-emerald-600 bg-emerald-50 px-1.5 py-0.5 rounded",children:"Market"})]}),e.jsxs("p",{className:"text-[10px] text-zinc-400 mt-1",children:["Market: RM ",_(t.purity).toFixed(2)]})]}),e.jsx(N,{label:"Weight (g)",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:t.weight,onChange:s=>v(t.id,"weight",s.target.value),leftIcon:zt,required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1.5",children:"Stone Deduction"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:t.stoneDeduction,onChange:s=>v(t.id,"stoneDeduction",s.target.value),className:"flex-1"}),e.jsx(Q,{value:t.stoneDeductionType,onChange:s=>v(t.id,"stoneDeductionType",s.target.value),options:[{value:"amount",label:"RM"},{value:"percent",label:"%"}],className:"w-20"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(N,{label:"Description / Remarks",placeholder:"e.g., 916 Gold Chain with pendant",value:t.description,onChange:s=>v(t.id,"description",s.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-1.5",children:"Item Photo"}),e.jsx("input",{ref:s=>ae.current[t.id]=s,type:"file",accept:"image/*",onChange:s=>Je(s,t.id),className:"hidden"}),t.photo?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:t.photo,alt:"Item",className:"w-20 h-20 object-cover rounded-lg border border-zinc-200"}),e.jsx("button",{type:"button",onClick:()=>v(t.id,"photo",null),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full",children:e.jsx(we,{className:"w-3 h-3"})})]}):e.jsx(p,{type:"button",variant:"outline",size:"sm",leftIcon:Ct,onClick:()=>ae.current[t.id]?.click(),children:"Upload Photo"})]})]}),t.weight&&t.category&&e.jsx("div",{className:"mt-4 pt-4 border-t border-zinc-200 bg-white rounded-lg p-3",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-zinc-500 block",children:"Price Used"}),e.jsxs("span",{className:"font-semibold text-zinc-800",children:["RM ",C(t).priceUsed.toFixed(2),"/g"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-zinc-500 block",children:"Gross Value"}),e.jsx("span",{className:"font-semibold text-zinc-800",children:n(C(t).gross)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-zinc-500 block",children:"Deduction"}),e.jsxs("span",{className:"font-semibold text-red-600",children:["- ",n(C(t).deduction)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-zinc-500 block",children:"Net Value"}),e.jsx("span",{className:"font-bold text-emerald-600 text-lg",children:n(C(t).net)})]})]})})]},t.id))}),e.jsx("div",{className:"mt-6 p-4 bg-amber-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700",children:"Total Items"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:f.filter(t=>t.category&&t.weight).length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700",children:"Total Weight"}),e.jsxs("p",{className:"text-xl font-bold text-zinc-800",children:[x.totalWeight.toFixed(2),"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700",children:"Gross Value"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:n(x.grossValue)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700",children:"Net Value"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:n(x.netValue)})]})]})})]},"step-2"),h===3&&e.jsxs(b.div,{variants:I,initial:"hidden",animate:"visible",exit:"exit",className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(se,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-800",children:"Valuation & Loan Amount"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Review calculation and set loan percentage"})]})]}),e.jsxs("div",{className:"border border-zinc-200 rounded-xl overflow-hidden mb-6",children:[e.jsx("div",{className:"bg-zinc-800 text-white px-4 py-3",children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Items Breakdown"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-zinc-50 border-b border-zinc-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-zinc-600",children:"#"}),e.jsx("th",{className:"text-left px-4 py-3 font-semibold text-zinc-600",children:"Item"}),e.jsx("th",{className:"text-center px-4 py-3 font-semibold text-zinc-600",children:"Purity"}),e.jsx("th",{className:"text-right px-4 py-3 font-semibold text-zinc-600",children:"Weight"}),e.jsx("th",{className:"text-right px-4 py-3 font-semibold text-zinc-600",children:"Price/g"}),e.jsx("th",{className:"text-right px-4 py-3 font-semibold text-zinc-600",children:"Gross"}),e.jsx("th",{className:"text-right px-4 py-3 font-semibold text-zinc-600",children:"Deduction"}),e.jsx("th",{className:"text-right px-4 py-3 font-semibold text-zinc-600",children:"Net Value"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100",children:f.filter(t=>t.category&&t.weight).map((t,a)=>{const s=C(t),l=Ae.find(d=>d.value===t.category);return e.jsxs("tr",{className:"hover:bg-zinc-50",children:[e.jsx("td",{className:"px-4 py-3 text-zinc-500",children:a+1}),e.jsx("td",{className:"px-4 py-3 font-medium",children:l?.label||t.category}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-700 rounded text-xs font-medium",children:t.purity})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[parseFloat(t.weight).toFixed(2),"g"]}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["RM ",s.priceUsed.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-right",children:n(s.gross)}),e.jsx("td",{className:"px-4 py-3 text-right text-red-600",children:s.deduction>0?`- ${n(s.deduction)}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold text-emerald-600",children:n(s.net)})]},t.id)})}),e.jsx("tfoot",{className:"bg-amber-50 border-t-2 border-amber-200",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"px-4 py-3 font-bold text-zinc-800",children:"TOTAL"}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold",children:[x.totalWeight.toFixed(2),"g"]}),e.jsx("td",{className:"px-4 py-3"}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:n(x.grossValue)}),e.jsx("td",{className:"px-4 py-3 text-right font-bold text-red-600",children:x.totalDeduction>0?`- ${n(x.totalDeduction)}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right font-bold text-emerald-600 text-lg",children:n(x.netValue)})]})})]})})]}),e.jsxs("div",{className:"border border-zinc-200 rounded-xl p-4 mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-zinc-700 mb-3",children:"Select Loan Percentage (Margin)"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[At.map(t=>e.jsxs("button",{type:"button",onClick:()=>{Ge(t),ie(!1)},className:y("px-6 py-3 rounded-lg font-bold transition-all text-lg",!V&&ne===t?"bg-amber-500 text-white shadow-lg":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"),children:[t,"%"]},t)),e.jsx("button",{type:"button",onClick:()=>ie(!0),className:y("px-6 py-3 rounded-lg font-bold transition-all",V?"bg-amber-500 text-white shadow-lg":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"),children:"Custom"})]}),V&&e.jsxs(b.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"flex items-center gap-2",children:[e.jsx(N,{type:"number",min:"1",max:"100",placeholder:"Enter %",value:re,onChange:t=>qe(t.target.value),className:"w-32"}),e.jsx("span",{className:"text-zinc-500",children:"%"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-zinc-800 to-zinc-900 text-white rounded-xl p-6 mb-6",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-amber-400"}),"Loan Calculation"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-zinc-700",children:[e.jsx("span",{className:"text-zinc-400",children:"Total Net Value (A)"}),e.jsx("span",{className:"font-semibold text-lg",children:n(x.netValue)})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-zinc-700",children:[e.jsx("span",{className:"text-zinc-400",children:"Loan Percentage (B)"}),e.jsxs("span",{className:"font-semibold text-lg",children:[S,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-zinc-700",children:[e.jsx("span",{className:"text-zinc-400",children:"Calculation (A × B)"}),e.jsxs("span",{className:"text-zinc-300",children:[n(x.netValue)," × ",S,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center py-4 bg-amber-500/20 -mx-6 px-6 rounded-lg",children:[e.jsx("span",{className:"text-amber-400 font-semibold text-lg",children:"LOAN AMOUNT"}),e.jsx("span",{className:"text-3xl font-bold text-amber-400",children:n(c)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"border border-blue-200 bg-blue-50 rounded-xl p-4",children:[e.jsxs("h5",{className:"font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4"}),"Interest Rates"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-white rounded-lg",children:[e.jsx("span",{className:"text-zinc-600",children:"First 6 months"}),e.jsx("span",{className:"font-bold text-blue-600",children:"0.5% / month"})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-white rounded-lg",children:[e.jsx("span",{className:"text-zinc-600",children:"After 6 months (renewed)"}),e.jsx("span",{className:"font-bold text-amber-600",children:"1.5% / month"})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-white rounded-lg",children:[e.jsx("span",{className:"text-zinc-600",children:"Overdue (not renewed)"}),e.jsx("span",{className:"font-bold text-red-600",children:"2.0% / month"})]})]})]}),e.jsxs("div",{className:"border border-emerald-200 bg-emerald-50 rounded-xl p-4",children:[e.jsxs("h5",{className:"font-semibold text-emerald-800 mb-3 flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),"Monthly Interest (First 6 Months)"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-white rounded-lg",children:[e.jsx("span",{className:"text-zinc-600",children:"Loan Amount"}),e.jsx("span",{className:"font-semibold",children:n(c)})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-white rounded-lg",children:[e.jsx("span",{className:"text-zinc-600",children:"Monthly Interest (0.5%)"}),e.jsx("span",{className:"font-bold text-emerald-600",children:n(c*.005)})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-amber-100 rounded-lg border border-amber-200",children:[e.jsx("span",{className:"text-amber-800 font-medium",children:"6 Months Total Interest"}),e.jsx("span",{className:"font-bold text-amber-700",children:n(c*.005*6)})]})]})]})]}),e.jsxs("div",{className:"border-2 border-amber-300 bg-amber-50 rounded-xl p-4",children:[e.jsxs("h5",{className:"font-semibold text-amber-800 mb-3 flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Redemption Estimate (If Redeemed Within 6 Months)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-amber-200",children:[e.jsx("p",{className:"text-xs text-zinc-500 mb-1",children:"After 1 Month"}),e.jsx("p",{className:"font-bold text-amber-700",children:n(c+c*.005*1)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-amber-200",children:[e.jsx("p",{className:"text-xs text-zinc-500 mb-1",children:"After 3 Months"}),e.jsx("p",{className:"font-bold text-amber-700",children:n(c+c*.005*3)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-amber-200",children:[e.jsx("p",{className:"text-xs text-zinc-500 mb-1",children:"After 6 Months"}),e.jsx("p",{className:"font-bold text-amber-700",children:n(c+c*.005*6)})]})]}),e.jsx("p",{className:"text-xs text-amber-600 mt-3 text-center",children:"* Redemption Amount = Loan + Interest. Grace period of 7 days after due date."})]}),e.jsxs("div",{className:"mt-4 p-4 bg-zinc-100 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(St,{className:"w-5 h-5 text-zinc-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-zinc-700",children:"Loan Period"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Standard 6 months tenure"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-zinc-500",children:"Due Date"}),e.jsx("p",{className:"font-bold text-zinc-800",children:new Date(Date.now()+4320*60*60*1e3).toLocaleDateString("en-MY",{day:"2-digit",month:"short",year:"numeric"})})]})]})]},"step-3"),h===4&&e.jsxs(b.div,{variants:I,initial:"hidden",animate:"visible",exit:"exit",className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(D,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-800",children:"Payout Method"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Select how to pay the customer"})]})]}),e.jsx("div",{className:"p-4 bg-emerald-50 border border-emerald-200 rounded-xl mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-emerald-700 font-medium",children:"Total Payout Amount"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-600",children:n(c)})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-3",children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"cash",label:"Full Cash",icon:D},{value:"transfer",label:"Full Transfer",icon:ke},{value:"partial",label:"Partial",icon:xt}].map(t=>e.jsxs("button",{type:"button",onClick:()=>Be(t.value),className:y("p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2",m===t.value?"border-amber-500 bg-amber-50":"border-zinc-200 hover:border-zinc-300"),children:[e.jsx(t.icon,{className:y("w-6 h-6",m===t.value?"text-amber-600":"text-zinc-400")}),e.jsx("span",{className:y("font-medium",m===t.value?"text-amber-600":"text-zinc-600"),children:t.label})]},t.value))})]}),e.jsxs("div",{className:"space-y-4",children:[(m==="cash"||m==="partial")&&e.jsx(N,{label:"Cash Amount (RM)",type:"number",step:"0.01",value:w,onChange:t=>O(t.target.value),disabled:m==="cash",leftIcon:D}),(m==="transfer"||m==="partial")&&e.jsxs(e.Fragment,{children:[e.jsx(N,{label:"Transfer Amount (RM)",type:"number",step:"0.01",value:z,onChange:t=>K(t.target.value),disabled:m==="transfer",leftIcon:ke}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(N,{label:"Bank Name",placeholder:"e.g., Maybank",value:L,onChange:t=>Ue(t.target.value),required:!0}),e.jsx(N,{label:"Account Number",placeholder:"Enter account number",value:W,onChange:t=>Oe(t.target.value),required:!0})]}),e.jsx(N,{label:"Reference Number (Optional)",placeholder:"Transaction reference",value:ce,onChange:t=>Ke(t.target.value)})]})]}),m==="partial"&&e.jsx("div",{className:"mt-4 p-3 bg-zinc-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-zinc-500",children:"Cash + Transfer"}),e.jsx("span",{className:y("font-medium",Math.abs((parseFloat(w)||0)+(parseFloat(z)||0)-c)<.01?"text-emerald-600":"text-red-600"),children:n((parseFloat(w)||0)+(parseFloat(z)||0))})]})})]},"step-4"),h===5&&e.jsxs(b.div,{variants:I,initial:"hidden",animate:"visible",exit:"exit",className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(Ve,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-800",children:"Review & Confirm"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Review details and capture signature"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-zinc-50 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-zinc-800 mb-3",children:"Customer"}),e.jsx("p",{className:"font-medium text-zinc-800",children:o?.name}),e.jsx("p",{className:"text-sm text-zinc-500",children:o&&J(o.icNumber)}),e.jsx("p",{className:"text-sm text-zinc-500",children:o&&Se(o.phone)})]}),e.jsxs("div",{className:"p-4 bg-zinc-50 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-zinc-800 mb-3",children:"Items"}),e.jsxs("p",{className:"text-zinc-600",children:[f.filter(t=>t.category).length," item(s)"]}),e.jsxs("p",{className:"text-sm text-zinc-500",children:["Total Weight: ",x.totalWeight.toFixed(2),"g"]}),e.jsxs("p",{className:"text-sm text-zinc-500",children:["Net Value: ",n(x.netValue)]})]}),e.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-emerald-800 mb-3",children:"Loan Details"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:n(c)}),e.jsxs("p",{className:"text-sm text-emerald-600",children:["@ ",S,"% of net value"]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"Payout"}),e.jsx("p",{className:"text-zinc-600 capitalize",children:m}),(parseFloat(w)||0)>0&&e.jsxs("p",{className:"text-sm text-zinc-500",children:["Cash: ",n(parseFloat(w))]}),(parseFloat(z)||0)>0&&e.jsxs("p",{className:"text-sm text-zinc-500",children:["Transfer: ",n(parseFloat(z))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"text-sm font-medium text-zinc-700",children:["Customer Signature ",e.jsx("span",{className:"text-red-500",children:"*"})]}),$&&e.jsx(p,{variant:"ghost",size:"sm",onClick:Qe,children:"Clear Signature"})]}),e.jsx("div",{className:"border-2 border-dashed border-zinc-300 rounded-xl p-2 bg-white",children:e.jsx("canvas",{ref:P,width:600,height:150,className:"w-full cursor-crosshair touch-none",onMouseDown:fe,onMouseMove:je,onMouseUp:X,onMouseLeave:X,onTouchStart:fe,onTouchMove:je,onTouchEnd:X})}),e.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:"Sign above using mouse or touch"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:me,onChange:t=>xe(t.target.checked),className:"w-5 h-5 mt-0.5 rounded border-zinc-300 text-amber-500 focus:ring-amber-500"}),e.jsx("span",{className:"text-sm text-zinc-600",children:"I confirm that all information is correct and agree to the terms and conditions of this pledge transaction."})]})}),e.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"w-5 h-5 text-amber-600"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium text-amber-800",children:["Due Date: ",new Date(Date.now()+4320*60*60*1e3).toLocaleDateString("en-MY",{day:"numeric",month:"long",year:"numeric"})]}),e.jsx("p",{className:"text-amber-600",children:"6 months from today. Interest at 0.5% per month."})]})]})})]},"step-5")]}),e.jsxs("div",{className:"flex justify-between p-6 border-t border-zinc-200",children:[e.jsx(p,{variant:"outline",leftIcon:Me,onClick:tt,disabled:h===1,children:"Previous"}),h<5?e.jsx(p,{variant:"accent",rightIcon:Pt,onClick:et,children:"Next Step"}):e.jsx(p,{variant:"success",leftIcon:Pe,onClick:st,loading:$e,children:"Create Pledge"})]})]}),e.jsx(jt,{isOpen:Ye,onClose:()=>{},title:"Pledge Created Successfully!",size:"md",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"w-20 h-20 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(ht,{className:"w-10 h-10 text-emerald-600"})}),e.jsx("h3",{className:"text-xl font-bold text-zinc-800 mb-2",children:"Pledge Created!"}),e.jsxs("p",{className:"text-zinc-500 mb-4",children:["Pledge ID: ",e.jsx("span",{className:"font-mono font-bold text-zinc-800",children:pe})]}),e.jsx("div",{className:"p-4 bg-zinc-50 rounded-xl mb-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500",children:"Customer"}),e.jsx("p",{className:"font-medium text-zinc-800",children:o?.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500",children:"Loan Amount"}),e.jsx("p",{className:"font-medium text-emerald-600",children:n(c)})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(p,{variant:"outline",fullWidth:!0,leftIcon:It,onClick:()=>{i(u({type:"info",title:"Print",message:"Opening print dialog..."}))},children:"Print Receipt"}),e.jsx(p,{variant:"outline",fullWidth:!0,leftIcon:kt,onClick:()=>{i(u({type:"info",title:"WhatsApp",message:"Sending to customer..."}))},children:"Send WhatsApp"})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx(p,{variant:"primary",fullWidth:!0,onClick:()=>E(`/pledges/${pe}`),children:"View Pledge"}),e.jsx(p,{variant:"accent",fullWidth:!0,leftIcon:Z,onClick:()=>{ue(!1),q(1),T(null),B(""),U(null),F([{...ee,id:"item-1"}]),Y(null),xe(!1)},children:"New Pledge"})]})]})})]})}export{es as default};
