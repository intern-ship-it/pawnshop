import{a as re,u as ie,t as le,b as ce,r as c,g as G,k as K,j as e,U as L,C as ne,F as oe,X as z,d as Y,v as F,S as X,e as g,s as de}from"./index-o28qtZ4E.js";import{a as me,v as ue,b as he}from"./validators-DzCKJgm6.js";import{a as xe}from"./formatters-BhAPqf4o.js";import{P as pe}from"./PageWrapper-D4uzFYGf.js";import{m as n,B as A}from"./proxy-D6mGC7EI.js";import{C as p,I as h,S as fe}from"./Modal-7Sg338uS.js";import"./Badge-Br48OPWn.js";import{C as be}from"./credit-card-CogcOOr3.js";import{C as E}from"./check-DGHPnJ4E.js";import{B as ge,I as je}from"./image-CwN3KknU.js";import{P as O}from"./phone-B5sqxf62.js";import{M as Ne}from"./mail-DO_TKUji.js";import{M as ve}from"./map-pin-CM4a5Gr_.js";import{A as U}from"./index-B9GDT2Wk.js";import{U as J}from"./upload-Bok2fDOh.js";import{C as Ce}from"./camera-BqlqEqVf.js";import{S as ye}from"./save-CPbhu9KD.js";import{A as we}from"./arrow-left-Bj3muJoB.js";function Ve(){const I=re(),d=ie(),[_]=le(),{customers:H}=ce(s=>s.customers),j=c.useRef(null),N=c.useRef(null),v=c.useRef(null),[r,k]=c.useState({name:"",icNumber:_.get("ic")||"",phone:"",whatsapp:"",email:"",address:"",dateOfBirth:"",gender:"",occupation:""}),[C,q]=c.useState(null),[y,R]=c.useState(null),[S,T]=c.useState(null),[l,x]=c.useState({}),[f,D]=c.useState({}),[M,$]=c.useState(!1),[w,Q]=c.useState(!0);c.useEffect(()=>{const s=G(X.CUSTOMERS,[]);d(K(s))},[d]),c.useEffect(()=>{w&&k(s=>({...s,whatsapp:s.phone}))},[r.phone,w]),c.useEffect(()=>{const s=r.icNumber.replace(/[-\s]/g,"");if(s.length>=6){const t=s.substring(0,2),a=s.substring(2,4),i=s.substring(4,6),u=`${parseInt(t)<=30?`20${t}`:`19${t}`}-${a}-${i}`,ae=new Date(u);isNaN(ae.getTime())||k(te=>({...te,dateOfBirth:u}))}},[r.icNumber]);const o=s=>{const{name:t,value:a}=s.target;k(i=>({...i,[t]:a})),l[t]&&x(i=>({...i,[t]:null}))},b=s=>{const{name:t}=s.target;D(a=>({...a,[t]:!0})),V(t,r[t])},V=(s,t)=>{let a=null;switch(s){case"name":t.trim()?t.trim().length<3&&(a="Name must be at least 3 characters"):a="Full name is required";break;case"icNumber":const i=t.replace(/[-\s]/g,"");i?ue(i)?H.find(u=>u.icNumber.replace(/[-\s]/g,"")===i)&&(a="Customer with this IC already exists"):a="Invalid IC format (12 digits required)":a="IC number is required";break;case"phone":t.trim()?me(t)||(a="Invalid phone format"):a="Phone number is required";break;case"email":t&&!he(t)&&(a="Invalid email format");break;case"address":t.trim()||(a="Address is required");break}return x(i=>({...i,[s]:a})),!a},Z=()=>{const s=["name","icNumber","phone","address"];let t=!0;return s.forEach(a=>{V(a,r[a])||(t=!1),D(i=>({...i,[a]:!0}))}),C||(x(a=>({...a,icFront:"IC front image is required"})),t=!1),y||(x(a=>({...a,icBack:"IC back image is required"})),t=!1),t},B=(s,t)=>{const a=s.target.files?.[0];if(!a)return;if(!a.type.startsWith("image/")){d(g({type:"error",title:"Invalid File",message:"Please upload an image file"}));return}if(a.size>5*1024*1024){d(g({type:"error",title:"File Too Large",message:"Image must be less than 5MB"}));return}const i=new FileReader;i.onloadend=()=>{const m=i.result;switch(t){case"icFront":q(m),x(u=>({...u,icFront:null}));break;case"icBack":R(m),x(u=>({...u,icBack:null}));break;case"profile":T(m);break}d(g({type:"success",title:"Image Uploaded",message:`${t==="icFront"?"IC Front":t==="icBack"?"IC Back":"Profile Photo"} uploaded successfully`}))},i.readAsDataURL(a)},P=s=>{switch(s){case"icFront":q(null),j.current&&(j.current.value="");break;case"icBack":R(null),N.current&&(N.current.value="");break;case"profile":T(null),v.current&&(v.current.value="");break}},ee=s=>{if(s.preventDefault(),!Z()){d(g({type:"error",title:"Validation Error",message:"Please fix the errors before submitting"}));return}$(!0),setTimeout(()=>{const t=G(X.CUSTOMERS,[]),a=`CUS${String(t.length+1).padStart(3,"0")}`,i={id:a,name:r.name.trim(),icNumber:r.icNumber.replace(/[-\s]/g,""),phone:r.phone.trim(),whatsapp:r.whatsapp.trim()||r.phone.trim(),email:r.email.trim(),address:r.address.trim(),dateOfBirth:r.dateOfBirth,gender:r.gender,occupation:r.occupation.trim(),icFrontImage:C,icBackImage:y,profilePhoto:S,activePledges:0,totalPledges:0,totalAmount:0,lastVisit:new Date().toISOString().split("T")[0],riskLevel:"low",status:"active",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},m=[...t,i];de(X.CUSTOMERS,m),d(K(m)),d(g({type:"success",title:"Customer Created",message:`${i.name} has been added successfully`})),$(!1),I(`/customers/${a}`)},800)},se={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},W={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e.jsx(pe,{title:"Add New Customer",subtitle:"Register a new customer in the system",actions:e.jsx(A,{variant:"outline",leftIcon:we,onClick:()=>I("/customers"),children:"Back to List"}),children:e.jsx("form",{onSubmit:ee,children:e.jsxs(n.div,{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",variants:se,initial:"hidden",animate:"visible",children:[e.jsxs(n.div,{className:"lg:col-span-2 space-y-6",variants:W,children:[e.jsxs(p,{children:[e.jsx("div",{className:"p-5 border-b border-zinc-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"Personal Information"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Basic customer details"})]})]})}),e.jsx("div",{className:"p-5 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(h,{label:"Full Name (as per IC)",name:"name",placeholder:"Enter full name",value:r.name,onChange:o,onBlur:b,error:f.name&&l.name,required:!0,leftIcon:L})}),e.jsxs("div",{children:[e.jsx(h,{label:"IC Number",name:"icNumber",placeholder:"XXXXXX-XX-XXXX",value:r.icNumber,onChange:o,onBlur:b,error:f.icNumber&&l.icNumber,required:!0,leftIcon:be}),r.icNumber&&!l.icNumber&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-1 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),"Formatted: ",xe(r.icNumber)]})]}),e.jsx("div",{children:e.jsx(h,{label:"Date of Birth",name:"dateOfBirth",type:"date",value:r.dateOfBirth,onChange:o,leftIcon:ne,hint:"Auto-filled from IC"})}),e.jsx("div",{children:e.jsx(fe,{label:"Gender",name:"gender",value:r.gender,onChange:o,options:[{value:"",label:"Select Gender"},{value:"male",label:"Male"},{value:"female",label:"Female"}]})}),e.jsx("div",{children:e.jsx(h,{label:"Occupation",name:"occupation",placeholder:"Enter occupation",value:r.occupation,onChange:o,leftIcon:ge})})]})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"p-5 border-b border-zinc-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"Contact Information"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Phone, email, and address"})]})]})}),e.jsx("div",{className:"p-5 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(h,{label:"Phone Number",name:"phone",placeholder:"01X-XXX XXXX",value:r.phone,onChange:o,onBlur:b,error:f.phone&&l.phone,required:!0,leftIcon:O})}),e.jsxs("div",{children:[e.jsx(h,{label:"WhatsApp Number",name:"whatsapp",placeholder:"01X-XXX XXXX",value:r.whatsapp,onChange:o,disabled:w,leftIcon:O}),e.jsxs("label",{className:"flex items-center gap-2 mt-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>Q(s.target.checked),className:"w-4 h-4 rounded border-zinc-300 text-amber-500 focus:ring-amber-500"}),e.jsx("span",{className:"text-sm text-zinc-600",children:"Same as phone number"})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(h,{label:"Email Address",name:"email",type:"email",placeholder:"email@example.com",value:r.email,onChange:o,onBlur:b,error:f.email&&l.email,leftIcon:Ne})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(h,{label:"Full Address",name:"address",placeholder:"Enter full address",value:r.address,onChange:o,onBlur:b,error:f.address&&l.address,required:!0,leftIcon:ve,multiline:!0})})]})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"p-5 border-b border-zinc-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"IC Copy (KPKT Requirement)"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Upload front and back of IC"})]})]})}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:["IC Front ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{ref:j,type:"file",accept:"image/*",onChange:s=>B(s,"icFront"),className:"hidden"}),e.jsx(U,{mode:"wait",children:C?e.jsxs(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"relative",children:[e.jsx("img",{src:C,alt:"IC Front",className:"w-full h-40 object-cover rounded-lg border border-zinc-200"}),e.jsx("button",{type:"button",onClick:()=>P("icFront"),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-emerald-500 text-white text-xs rounded-full flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),"Uploaded"]})]},"preview"):e.jsxs(n.button,{type:"button",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:()=>j.current?.click(),className:Y("w-full h-40 border-2 border-dashed rounded-lg flex flex-col items-center justify-center gap-2 transition-colors",l.icFront?"border-red-300 bg-red-50 text-red-500":"border-zinc-300 hover:border-amber-500 hover:bg-amber-50 text-zinc-400 hover:text-amber-500"),children:[e.jsx(J,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm font-medium",children:"Upload IC Front"}),e.jsx("span",{className:"text-xs",children:"Click or drag file here"})]},"upload")}),l.icFront&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),l.icFront]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:["IC Back ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:s=>B(s,"icBack"),className:"hidden"}),e.jsx(U,{mode:"wait",children:y?e.jsxs(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"relative",children:[e.jsx("img",{src:y,alt:"IC Back",className:"w-full h-40 object-cover rounded-lg border border-zinc-200"}),e.jsx("button",{type:"button",onClick:()=>P("icBack"),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-emerald-500 text-white text-xs rounded-full flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),"Uploaded"]})]},"preview"):e.jsxs(n.button,{type:"button",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:()=>N.current?.click(),className:Y("w-full h-40 border-2 border-dashed rounded-lg flex flex-col items-center justify-center gap-2 transition-colors",l.icBack?"border-red-300 bg-red-50 text-red-500":"border-zinc-300 hover:border-amber-500 hover:bg-amber-50 text-zinc-400 hover:text-amber-500"),children:[e.jsx(J,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm font-medium",children:"Upload IC Back"}),e.jsx("span",{className:"text-xs",children:"Click or drag file here"})]},"upload")}),l.icBack&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),l.icBack]})]})]})})]})]}),e.jsxs(n.div,{className:"space-y-6",variants:W,children:[e.jsxs(p,{children:[e.jsx("div",{className:"p-5 border-b border-zinc-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"Profile Photo"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Optional"})]})]})}),e.jsxs("div",{className:"p-5",children:[e.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:s=>B(s,"profile"),className:"hidden"}),e.jsx(U,{mode:"wait",children:S?e.jsxs(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"relative",children:[e.jsx("img",{src:S,alt:"Profile",className:"w-full aspect-square object-cover rounded-xl border border-zinc-200"}),e.jsx("button",{type:"button",onClick:()=>P("profile"),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(z,{className:"w-4 h-4"})})]},"preview"):e.jsxs(n.button,{type:"button",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:()=>v.current?.click(),className:"w-full aspect-square border-2 border-dashed border-zinc-300 rounded-xl flex flex-col items-center justify-center gap-3 hover:border-amber-500 hover:bg-amber-50 transition-colors text-zinc-400 hover:text-amber-500",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-zinc-100 flex items-center justify-center",children:e.jsx(je,{className:"w-8 h-8"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Upload Photo"}),e.jsx("p",{className:"text-xs",children:"JPG, PNG up to 5MB"})]})]},"upload")})]})]}),e.jsxs(p,{className:"p-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(A,{type:"submit",variant:"accent",size:"lg",fullWidth:!0,leftIcon:ye,loading:M,children:M?"Saving...":"Save Customer"}),e.jsx(A,{type:"button",variant:"outline",size:"lg",fullWidth:!0,onClick:()=>I("/customers"),children:"Cancel"})]}),Object.keys(l).some(s=>l[s])&&e.jsxs(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium text-red-800 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Please fix the following errors:"]}),e.jsx("ul",{className:"mt-2 text-xs text-red-600 space-y-1",children:Object.keys(l).map(s=>l[s]&&e.jsxs("li",{children:["â€¢ ",l[s]]},s))})]})]}),e.jsxs(p,{className:"p-5 bg-amber-50 border-amber-200",children:[e.jsx("h4",{className:"font-semibold text-amber-800 mb-2",children:"ðŸ’¡ Tips"}),e.jsxs("ul",{className:"text-sm text-amber-700 space-y-1",children:[e.jsx("li",{children:"â€¢ IC copy is required by KPKT regulations"}),e.jsx("li",{children:"â€¢ Date of birth is auto-filled from IC"}),e.jsx("li",{children:"â€¢ WhatsApp is used for sending receipts"})]})]})]})]})})})}export{Ve as default};
