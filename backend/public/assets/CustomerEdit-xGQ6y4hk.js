import{p as ne,a as oe,u as de,b as me,r as c,g as J,k as _,j as e,U as q,C as he,F as ue,R as O,X as T,v as Q,S as M,e as b,s as pe}from"./index-o28qtZ4E.js";import{a as xe,v as fe,b as be}from"./validators-DzCKJgm6.js";import{a as ge}from"./formatters-BhAPqf4o.js";import{P as Z}from"./PageWrapper-D4uzFYGf.js";import{B,m as o}from"./proxy-D6mGC7EI.js";import{C as x,I as h,S as je}from"./Modal-7Sg338uS.js";import"./Badge-Br48OPWn.js";import{C as Ne}from"./credit-card-CogcOOr3.js";import{C as $}from"./check-DGHPnJ4E.js";import{B as ve,I as Ce}from"./image-CwN3KknU.js";import{P as L}from"./phone-B5sqxf62.js";import{M as ye}from"./mail-DO_TKUji.js";import{M as we}from"./map-pin-CM4a5Gr_.js";import{A as G}from"./index-B9GDT2Wk.js";import{U as ee}from"./upload-Bok2fDOh.js";import{C as Ie}from"./camera-BqlqEqVf.js";import{S as ke}from"./save-CPbhu9KD.js";import{A as Be}from"./arrow-left-Bj3muJoB.js";function We(){const{id:u}=ne(),z=oe(),d=de(),{customers:se}=me(a=>a.customers),g=c.useRef(null),j=c.useRef(null),N=c.useRef(null),[t,ae]=c.useState(null),[r,S]=c.useState({name:"",icNumber:"",phone:"",whatsapp:"",email:"",address:"",dateOfBirth:"",gender:"",occupation:""}),[v,P]=c.useState(null),[C,F]=c.useState(null),[y,X]=c.useState(null),[n,w]=c.useState({}),[I,E]=c.useState({}),[V,W]=c.useState(!1),[A,K]=c.useState(!1),[R,te]=c.useState(!1);c.useEffect(()=>{const a=J(M.CUSTOMERS,[]);d(_(a));const s=a.find(i=>i.id===u);s&&(ae(s),S({name:s.name||"",icNumber:s.icNumber||"",phone:s.phone||"",whatsapp:s.whatsapp||"",email:s.email||"",address:s.address||"",dateOfBirth:s.dateOfBirth||"",gender:s.gender||"",occupation:s.occupation||""}),P(s.icFrontImage),F(s.icBackImage),X(s.profilePhoto),K(s.phone===s.whatsapp))},[u,d]),c.useEffect(()=>{if(!t)return;const a=r.name!==t.name||r.icNumber!==t.icNumber||r.phone!==t.phone||r.whatsapp!==t.whatsapp||r.email!==(t.email||"")||r.address!==t.address||r.dateOfBirth!==(t.dateOfBirth||"")||r.gender!==(t.gender||"")||r.occupation!==(t.occupation||"")||v!==t.icFrontImage||C!==t.icBackImage||y!==t.profilePhoto;te(a)},[r,v,C,y,t]),c.useEffect(()=>{A&&S(a=>({...a,whatsapp:a.phone}))},[r.phone,A]);const m=a=>{const{name:s,value:i}=a.target;S(l=>({...l,[s]:i})),n[s]&&w(l=>({...l,[s]:null}))},k=a=>{const{name:s}=a.target;E(i=>({...i,[s]:!0})),Y(s,r[s])},Y=(a,s)=>{let i=null;switch(a){case"name":s.trim()?s.trim().length<3&&(i="Name must be at least 3 characters"):i="Full name is required";break;case"icNumber":const l=s.replace(/[-\s]/g,"");l?fe(l)?se.find(f=>f.icNumber.replace(/[-\s]/g,"")===l&&f.id!==u)&&(i="Another customer with this IC already exists"):i="Invalid IC format (12 digits required)":i="IC number is required";break;case"phone":s.trim()?xe(s)||(i="Invalid phone format"):i="Phone number is required";break;case"email":s&&!be(s)&&(i="Invalid email format");break;case"address":s.trim()||(i="Address is required");break}return w(l=>({...l,[a]:i})),!i},re=()=>{const a=["name","icNumber","phone","address"];let s=!0;return a.forEach(i=>{Y(i,r[i])||(s=!1),E(l=>({...l,[i]:!0}))}),s},U=(a,s)=>{const i=a.target.files?.[0];if(!i)return;if(!i.type.startsWith("image/")){d(b({type:"error",title:"Invalid File",message:"Please upload an image file"}));return}if(i.size>5*1024*1024){d(b({type:"error",title:"File Too Large",message:"Image must be less than 5MB"}));return}const l=new FileReader;l.onloadend=()=>{const p=l.result;switch(s){case"icFront":P(p),w(f=>({...f,icFront:null}));break;case"icBack":F(p),w(f=>({...f,icBack:null}));break;case"profile":X(p);break}d(b({type:"success",title:"Image Uploaded",message:`${s==="icFront"?"IC Front":s==="icBack"?"IC Back":"Profile Photo"} updated`}))},l.readAsDataURL(i)},D=a=>{switch(a){case"icFront":P(null),g.current&&(g.current.value="");break;case"icBack":F(null),j.current&&(j.current.value="");break;case"profile":X(null),N.current&&(N.current.value="");break}},ie=()=>{t&&(S({name:t.name||"",icNumber:t.icNumber||"",phone:t.phone||"",whatsapp:t.whatsapp||"",email:t.email||"",address:t.address||"",dateOfBirth:t.dateOfBirth||"",gender:t.gender||"",occupation:t.occupation||""}),P(t.icFrontImage),F(t.icBackImage),X(t.profilePhoto),w({}),E({}),d(b({type:"info",title:"Reset",message:"Form reset to original values"})))},le=a=>{if(a.preventDefault(),!re()){d(b({type:"error",title:"Validation Error",message:"Please fix the errors before saving"}));return}W(!0),setTimeout(()=>{const s=J(M.CUSTOMERS,[]),i={...t,name:r.name.trim(),icNumber:r.icNumber.replace(/[-\s]/g,""),phone:r.phone.trim(),whatsapp:r.whatsapp.trim()||r.phone.trim(),email:r.email.trim(),address:r.address.trim(),dateOfBirth:r.dateOfBirth,gender:r.gender,occupation:r.occupation.trim(),icFrontImage:v,icBackImage:C,profilePhoto:y,updatedAt:new Date().toISOString()},l=s.map(p=>p.id===u?i:p);pe(M.CUSTOMERS,l),d(_(l)),d(b({type:"success",title:"Customer Updated",message:`${i.name} has been updated successfully`})),W(!1),z(`/customers/${u}`)},800)},ce={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},H={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return t?e.jsx(Z,{title:`Edit: ${t.name}`,subtitle:`Customer ID: ${t.id}`,actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{variant:"outline",leftIcon:Be,onClick:()=>z(`/customers/${u}`),children:"Back to Profile"}),R&&e.jsx(B,{variant:"ghost",leftIcon:O,onClick:ie,children:"Reset"})]}),children:e.jsx("form",{onSubmit:le,children:e.jsxs(o.div,{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",variants:ce,initial:"hidden",animate:"visible",children:[e.jsxs(o.div,{className:"lg:col-span-2 space-y-6",variants:H,children:[e.jsxs(x,{children:[e.jsx("div",{className:"p-5 border-b border-zinc-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(q,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"Personal Information"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Basic customer details"})]})]})}),e.jsx("div",{className:"p-5 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(h,{label:"Full Name (as per IC)",name:"name",placeholder:"Enter full name",value:r.name,onChange:m,onBlur:k,error:I.name&&n.name,required:!0,leftIcon:q})}),e.jsxs("div",{children:[e.jsx(h,{label:"IC Number",name:"icNumber",placeholder:"XXXXXX-XX-XXXX",value:r.icNumber,onChange:m,onBlur:k,error:I.icNumber&&n.icNumber,required:!0,leftIcon:Ne}),r.icNumber&&!n.icNumber&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-1 flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),"Formatted: ",ge(r.icNumber)]})]}),e.jsx("div",{children:e.jsx(h,{label:"Date of Birth",name:"dateOfBirth",type:"date",value:r.dateOfBirth,onChange:m,leftIcon:he})}),e.jsx("div",{children:e.jsx(je,{label:"Gender",name:"gender",value:r.gender,onChange:m,options:[{value:"",label:"Select Gender"},{value:"male",label:"Male"},{value:"female",label:"Female"}]})}),e.jsx("div",{children:e.jsx(h,{label:"Occupation",name:"occupation",placeholder:"Enter occupation",value:r.occupation,onChange:m,leftIcon:ve})})]})})]}),e.jsxs(x,{children:[e.jsx("div",{className:"p-5 border-b border-zinc-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"Contact Information"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Phone, email, and address"})]})]})}),e.jsx("div",{className:"p-5 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(h,{label:"Phone Number",name:"phone",placeholder:"01X-XXX XXXX",value:r.phone,onChange:m,onBlur:k,error:I.phone&&n.phone,required:!0,leftIcon:L})}),e.jsxs("div",{children:[e.jsx(h,{label:"WhatsApp Number",name:"whatsapp",placeholder:"01X-XXX XXXX",value:r.whatsapp,onChange:m,disabled:A,leftIcon:L}),e.jsxs("label",{className:"flex items-center gap-2 mt-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:a=>K(a.target.checked),className:"w-4 h-4 rounded border-zinc-300 text-amber-500 focus:ring-amber-500"}),e.jsx("span",{className:"text-sm text-zinc-600",children:"Same as phone number"})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(h,{label:"Email Address",name:"email",type:"email",placeholder:"email@example.com",value:r.email,onChange:m,onBlur:k,error:I.email&&n.email,leftIcon:ye})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(h,{label:"Full Address",name:"address",placeholder:"Enter full address",value:r.address,onChange:m,onBlur:k,error:I.address&&n.address,required:!0,leftIcon:we,multiline:!0})})]})})]}),e.jsxs(x,{children:[e.jsx("div",{className:"p-5 border-b border-zinc-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"IC Copy (KPKT Requirement)"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Update front and back of IC"})]})]})}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"IC Front"}),e.jsx("input",{ref:g,type:"file",accept:"image/*",onChange:a=>U(a,"icFront"),className:"hidden"}),e.jsx(G,{mode:"wait",children:v?e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"relative",children:[e.jsx("img",{src:v,alt:"IC Front",className:"w-full h-40 object-cover rounded-lg border border-zinc-200"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>g.current?.click(),className:"p-1 bg-amber-500 text-white rounded-full hover:bg-amber-600 transition-colors",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>D("icFront"),className:"p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(T,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-emerald-500 text-white text-xs rounded-full flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),"Uploaded"]})]},"preview"):e.jsxs(o.button,{type:"button",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:()=>g.current?.click(),className:"w-full h-40 border-2 border-dashed border-zinc-300 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-amber-500 hover:bg-amber-50 transition-colors text-zinc-400 hover:text-amber-500",children:[e.jsx(ee,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm font-medium",children:"Upload IC Front"}),e.jsx("span",{className:"text-xs",children:"Click or drag file here"})]},"upload")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-700 mb-2",children:"IC Back"}),e.jsx("input",{ref:j,type:"file",accept:"image/*",onChange:a=>U(a,"icBack"),className:"hidden"}),e.jsx(G,{mode:"wait",children:C?e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"relative",children:[e.jsx("img",{src:C,alt:"IC Back",className:"w-full h-40 object-cover rounded-lg border border-zinc-200"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>j.current?.click(),className:"p-1 bg-amber-500 text-white rounded-full hover:bg-amber-600 transition-colors",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>D("icBack"),className:"p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(T,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-emerald-500 text-white text-xs rounded-full flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),"Uploaded"]})]},"preview"):e.jsxs(o.button,{type:"button",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:()=>j.current?.click(),className:"w-full h-40 border-2 border-dashed border-zinc-300 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-amber-500 hover:bg-amber-50 transition-colors text-zinc-400 hover:text-amber-500",children:[e.jsx(ee,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm font-medium",children:"Upload IC Back"}),e.jsx("span",{className:"text-xs",children:"Click or drag file here"})]},"upload")})]})]})})]})]}),e.jsxs(o.div,{className:"space-y-6",variants:H,children:[e.jsxs(x,{children:[e.jsx("div",{className:"p-5 border-b border-zinc-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"Profile Photo"}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Optional"})]})]})}),e.jsxs("div",{className:"p-5",children:[e.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:a=>U(a,"profile"),className:"hidden"}),e.jsx(G,{mode:"wait",children:y?e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"relative",children:[e.jsx("img",{src:y,alt:"Profile",className:"w-full aspect-square object-cover rounded-xl border border-zinc-200"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>N.current?.click(),className:"p-1.5 bg-amber-500 text-white rounded-full hover:bg-amber-600 transition-colors",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>D("profile"),className:"p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(T,{className:"w-4 h-4"})})]})]},"preview"):e.jsxs(o.button,{type:"button",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:()=>N.current?.click(),className:"w-full aspect-square border-2 border-dashed border-zinc-300 rounded-xl flex flex-col items-center justify-center gap-3 hover:border-amber-500 hover:bg-amber-50 transition-colors text-zinc-400 hover:text-amber-500",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-zinc-100 flex items-center justify-center",children:e.jsx(Ce,{className:"w-8 h-8"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Upload Photo"}),e.jsx("p",{className:"text-xs",children:"JPG, PNG up to 5MB"})]})]},"upload")})]})]}),e.jsxs(x,{className:"p-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{type:"submit",variant:"accent",size:"lg",fullWidth:!0,leftIcon:ke,loading:V,disabled:!R,children:V?"Saving...":"Save Changes"}),e.jsx(B,{type:"button",variant:"outline",size:"lg",fullWidth:!0,onClick:()=>z(`/customers/${u}`),children:"Cancel"})]}),R&&e.jsx(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-800 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"You have unsaved changes"]})}),Object.keys(n).some(a=>n[a])&&e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium text-red-800 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Please fix the following errors:"]}),e.jsx("ul",{className:"mt-2 text-xs text-red-600 space-y-1",children:Object.keys(n).map(a=>n[a]&&e.jsxs("li",{children:["â€¢ ",n[a]]},a))})]})]}),e.jsxs(x,{className:"p-5 bg-zinc-50 border-zinc-200",children:[e.jsx("h4",{className:"font-semibold text-zinc-700 mb-3",children:"Customer Info"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"Customer ID"}),e.jsx("span",{className:"font-mono text-zinc-700",children:t.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"Created"}),e.jsx("span",{className:"text-zinc-700",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"Last Updated"}),e.jsx("span",{className:"text-zinc-700",children:new Date(t.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"Active Pledges"}),e.jsx("span",{className:"font-semibold text-amber-600",children:t.activePledges})]})]})]})]})]})})}):e.jsx(Z,{title:"Customer Not Found",children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(q,{className:"w-16 h-16 text-zinc-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-zinc-800 mb-2",children:"Customer Not Found"}),e.jsx("p",{className:"text-zinc-500 mb-4",children:"The customer you're trying to edit doesn't exist."}),e.jsx(B,{variant:"accent",onClick:()=>z("/customers"),children:"Back to Customers"})]})})}export{We as default};
