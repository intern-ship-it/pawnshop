import{p as ae,a as ie,u as le,r as x,g as $,j as e,P as v,y as ce,T as ne,q as K,d as f,R as z,F as re,W as de,h as oe,C as me,S as k,s as xe,x as he,e as D,z as B}from"./index-o28qtZ4E.js";import{c as o,a as ue,b as pe,f as a}from"./formatters-BhAPqf4o.js";import{P as E}from"./PageWrapper-D4uzFYGf.js";import{B as l,m as d}from"./proxy-D6mGC7EI.js";import{C as h,M as F,I as je}from"./Modal-7Sg338uS.js";import{B as Ne}from"./Badge-Br48OPWn.js";import{D as b}from"./dollar-sign-CXfw5wgV.js";import{H}from"./history-DPeaAPFW.js";import{A as fe}from"./index-B9GDT2Wk.js";import{P as be}from"./phone-B5sqxf62.js";import{B as ve}from"./building-2-xsKCLuU5.js";import{S as ge}from"./square-pen-DhoP9-Gi.js";import{M as U}from"./map-pin-CM4a5Gr_.js";import{P as V}from"./printer-BXY7LAxL.js";import{M as G}from"./message-square-DD02v1BD.js";import{Q as ye}from"./qr-code-CJ14BqF9.js";import{C as ze}from"./clock-C6f4WYXs.js";import{A as we}from"./arrow-left-Bj3muJoB.js";const O={active:{label:"Active",color:"emerald",icon:K},overdue:{label:"Overdue",color:"red",icon:ne},redeemed:{label:"Redeemed",color:"blue",icon:b},forfeited:{label:"Forfeited",color:"amber",icon:ce},auctioned:{label:"Auctioned",color:"zinc",icon:v}},Pe=[{id:"overview",label:"Overview",icon:re},{id:"items",label:"Items",icon:v},{id:"history",label:"History",icon:H}];function He(){const{id:w}=ae(),j=ie(),u=le(),[s,A]=x.useState(null),[g,Q]=x.useState("overview"),[q,I]=x.useState(!1),[S,_]=x.useState(null),[X,N]=x.useState(!1),[y,R]=x.useState("");x.useEffect(()=>{const i=$(k.PLEDGES,[]).find(n=>n.id===w);if(i){const n=new Date;i.status==="active"&&new Date(i.dueDate)<n&&(i.status="overdue"),A(i),R(i.rackLocation||"")}},[w]);const m=(()=>{if(!s)return{months:0,rate:0,amount:0,total:0};const t=new Date(s.createdAt),n=Math.max(1,Math.ceil((new Date-t)/(1e3*60*60*24*30)));let P=0;for(let C=1;C<=n;C++){const te=C<=6?.5:1.5;P+=s.loanAmount*(te/100)}const ee=n<=6?.5:1.5,se=s.loanAmount+P;return{months:n,rate:ee,amount:P,total:se}})(),r=(()=>{if(!s)return 0;const t=new Date,i=new Date(s.dueDate);return Math.ceil((i-t)/(1e3*60*60*24))})(),Y=()=>{if(!s)return;const i=$(k.PLEDGES,[]).map(n=>n.id===w?{...n,rackLocation:y}:n);xe(k.PLEDGES,i),u(he(i)),A({...s,rackLocation:y}),N(!1),u(D({type:"success",title:"Saved",message:`Rack location updated to ${y}`}))},M=()=>{u(B(s)),j("/renewals")},L=()=>{u(B(s)),j("/redemptions")},T=()=>{u(D({type:"info",title:"Print",message:"Opening print dialog..."}))},W=()=>{if(!s?.customerPhone){u(D({type:"warning",title:"No Phone",message:"Customer phone not available"}));return}const t=`Hi ${s?.customerName}, your pledge ${s?.id} is due on ${o(s?.dueDate)}. Total amount due: ${a(m.total)}`;window.open(`https://wa.me/${s?.customerPhone?.replace(/\D/g,"")}?text=${encodeURIComponent(t)}`,"_blank")},J={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},p={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};if(!s)return e.jsx(E,{title:"Pledge Not Found",children:e.jsxs(h,{className:"p-12 text-center",children:[e.jsx(v,{className:"w-16 h-16 text-zinc-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-zinc-800 mb-2",children:"Pledge Not Found"}),e.jsx("p",{className:"text-zinc-500 mb-4",children:"The pledge you're looking for doesn't exist."}),e.jsx(l,{variant:"accent",onClick:()=>j("/pledges"),children:"Back to Pledges"})]})});const c=O[s.status]||O.active,Z=c.icon;return e.jsxs(E,{title:`Pledge: ${s.id}`,subtitle:`Created on ${o(s.createdAt)}`,actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{variant:"outline",leftIcon:we,onClick:()=>j("/pledges"),children:"Back"}),e.jsx(l,{variant:"outline",leftIcon:V,onClick:T,children:"Print"}),e.jsx(l,{variant:"outline",leftIcon:G,onClick:W,children:"WhatsApp"})]}),children:[e.jsxs(d.div,{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",variants:J,initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(d.div,{variants:p,children:e.jsx(h,{className:f("p-4 border-l-4",c.color==="emerald"&&"border-l-emerald-500 bg-emerald-50",c.color==="red"&&"border-l-red-500 bg-red-50",c.color==="blue"&&"border-l-blue-500 bg-blue-50",c.color==="amber"&&"border-l-amber-500 bg-amber-50",c.color==="zinc"&&"border-l-zinc-500 bg-zinc-50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:f("w-6 h-6",c.color==="emerald"&&"text-emerald-600",c.color==="red"&&"text-red-600",c.color==="blue"&&"text-blue-600",c.color==="amber"&&"text-amber-600",c.color==="zinc"&&"text-zinc-600")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-zinc-800",children:c.label}),(s.status==="active"||s.status==="overdue")&&e.jsx("p",{className:"text-sm text-zinc-600",children:r>0?`Due in ${r} days (${o(s.dueDate)})`:r===0?"Due today!":`Overdue by ${Math.abs(r)} days`})]})]}),(s.status==="active"||s.status==="overdue")&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",leftIcon:z,onClick:M,children:"Renew"}),e.jsx(l,{variant:"success",size:"sm",leftIcon:b,onClick:L,children:"Redeem"})]})]})})}),e.jsx(d.div,{variants:p,children:e.jsxs(h,{children:[e.jsx("div",{className:"flex border-b border-zinc-200",children:Pe.map(t=>{const i=t.icon;return e.jsxs("button",{onClick:()=>Q(t.id),className:f("flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors",g===t.id?"border-amber-500 text-amber-600":"border-transparent text-zinc-500 hover:text-zinc-700"),children:[e.jsx(i,{className:"w-4 h-4"}),t.label]},t.id)})}),e.jsxs(fe,{mode:"wait",children:[g==="overview"&&e.jsxs(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-zinc-500 uppercase mb-3",children:"Customer"}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white font-bold text-lg",children:s.customerName?.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-zinc-800",children:s.customerName}),e.jsx("p",{className:"text-sm text-zinc-500 font-mono",children:ue(s.customerIC)})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-600",children:[e.jsx(be,{className:"w-4 h-4 text-zinc-400"}),s.customerPhone?pe(s.customerPhone):"N/A"]}),e.jsx(l,{variant:"link",size:"sm",className:"p-0",onClick:()=>j(`/customers/${s.customerId}`),children:"View Customer Profile â†’"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-zinc-500 uppercase mb-3",children:"Loan Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-zinc-500",children:"Principal"}),e.jsx("span",{className:"font-medium",children:a(s.loanAmount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-zinc-500",children:["Interest (",m.months," mo @ ",m.rate,"%)"]}),e.jsx("span",{className:"font-medium text-amber-600",children:a(m.amount)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-zinc-200",children:[e.jsx("span",{className:"text-zinc-800 font-semibold",children:"Total Due"}),e.jsx("span",{className:"text-lg font-bold text-emerald-600",children:a(m.total)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-zinc-500 uppercase mb-3",children:"Payout Method"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.payoutMethod==="cash"&&e.jsx(de,{className:"w-4 h-4 text-emerald-500"}),s.payoutMethod==="transfer"&&e.jsx(ve,{className:"w-4 h-4 text-blue-500"}),s.payoutMethod==="partial"&&e.jsx(z,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"capitalize font-medium",children:s.payoutMethod})]}),s.cashAmount>0&&e.jsxs("p",{className:"text-zinc-500",children:["Cash: ",a(s.cashAmount)]}),s.transferAmount>0&&e.jsxs("div",{className:"text-zinc-500",children:[e.jsxs("p",{children:["Transfer: ",a(s.transferAmount)]}),s.bankName&&e.jsxs("p",{children:["Bank: ",s.bankName]}),s.accountNumber&&e.jsxs("p",{children:["A/C: ",s.accountNumber]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-zinc-500 uppercase mb-3",children:"Gold Price (at time)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 bg-zinc-50 rounded",children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"999 (24K)"}),e.jsx("p",{className:"font-medium",children:a(s.goldPriceUsed?.price999)})]}),e.jsxs("div",{className:"p-2 bg-zinc-50 rounded",children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"916 (22K)"}),e.jsx("p",{className:"font-medium",children:a(s.goldPriceUsed?.price916)})]}),e.jsxs("div",{className:"p-2 bg-zinc-50 rounded",children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"875 (21K)"}),e.jsx("p",{className:"font-medium",children:a(s.goldPriceUsed?.price875)})]}),e.jsxs("div",{className:"p-2 bg-zinc-50 rounded",children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"750 (18K)"}),e.jsx("p",{className:"font-medium",children:a(s.goldPriceUsed?.price750)})]})]})]})]}),s.signature&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-zinc-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-zinc-500 uppercase mb-3",children:"Customer Signature"}),e.jsx("img",{src:s.signature,alt:"Signature",className:"h-20 border border-zinc-200 rounded-lg bg-white"})]})]},"overview"),g==="items"&&e.jsxs(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-5",children:[e.jsx("div",{className:"space-y-4",children:s.items?.map((t,i)=>e.jsx("div",{className:"p-4 border border-zinc-200 rounded-xl hover:border-amber-300 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[t.photo?e.jsx("img",{src:t.photo,alt:t.description,className:"w-20 h-20 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{_(t.photo),I(!0)}}):e.jsx("div",{className:"w-20 h-20 bg-zinc-100 rounded-lg flex items-center justify-center",children:e.jsx(v,{className:"w-8 h-8 text-zinc-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ne,{variant:"outline",children:[t.purity," Gold"]}),e.jsx("span",{className:"text-sm text-zinc-500 capitalize",children:t.category})]}),e.jsx("span",{className:"font-mono text-xs text-zinc-400",children:t.barcode})]}),e.jsx("p",{className:"text-zinc-800 font-medium mb-2",children:t.description||`${t.category} - ${t.purity} Gold`}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500",children:"Weight"}),e.jsxs("p",{className:"font-medium",children:[parseFloat(t.weight).toFixed(2),"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500",children:"Gross Value"}),e.jsx("p",{className:"font-medium",children:a(t.grossValue)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500",children:"Deduction"}),e.jsxs("p",{className:"font-medium text-red-500",children:["-",a(t.deduction)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-500",children:"Net Value"}),e.jsx("p",{className:"font-semibold text-emerald-600",children:a(t.netValue)})]})]})]})]})},t.barcode||i))}),e.jsx("div",{className:"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700",children:"Total Items"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:s.items?.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700",children:"Total Weight"}),e.jsxs("p",{className:"text-xl font-bold text-zinc-800",children:[s.totalWeight?.toFixed(2),"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-700",children:"Net Value"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:a(s.netValue)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-amber-700",children:["Loan @ ",s.loanPercentage,"%"]}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:a(s.loanAmount)})]})]})})]},"items"),g==="history"&&e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0",children:e.jsx(v,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{className:"flex-1 pb-4 border-b border-zinc-100",children:[e.jsx("p",{className:"font-medium text-zinc-800",children:"Pledge Created"}),e.jsx("p",{className:"text-sm text-zinc-500",children:o(s.createdAt)}),e.jsxs("p",{className:"text-sm text-zinc-600 mt-1",children:["Loan amount: ",a(s.loanAmount)]})]})]}),s.renewals?.map((t,i)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 pb-4 border-b border-zinc-100",children:[e.jsx("p",{className:"font-medium text-zinc-800",children:"Renewal Payment"}),e.jsx("p",{className:"text-sm text-zinc-500",children:o(t.date)}),e.jsxs("p",{className:"text-sm text-zinc-600 mt-1",children:["Interest paid: ",a(t.amount)]})]})]},i)),s.status==="redeemed"&&s.redeemedAt&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx(b,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-zinc-800",children:"Pledge Redeemed"}),e.jsx("p",{className:"text-sm text-zinc-500",children:o(s.redeemedAt)}),e.jsxs("p",{className:"text-sm text-zinc-600 mt-1",children:["Total paid: ",a(s.redemptionAmount)]})]})]}),!s.renewals?.length&&s.status!=="redeemed"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"w-12 h-12 text-zinc-300 mx-auto mb-3"}),e.jsx("p",{className:"text-zinc-500",children:"No renewal history yet"})]})]})},"history")]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(d.div,{variants:p,children:e.jsxs(h,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-zinc-800 mb-4",children:"Quick Summary"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-zinc-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-zinc-400"}),e.jsx("span",{className:"text-zinc-600",children:"Principal"})]}),e.jsx("span",{className:"font-semibold",children:a(s.loanAmount)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-amber-500"}),e.jsx("span",{className:"text-amber-700",children:"Interest"})]}),e.jsx("span",{className:"font-semibold text-amber-600",children:a(m.amount)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-emerald-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-emerald-500"}),e.jsx("span",{className:"text-emerald-700",children:"Total Due"})]}),e.jsx("span",{className:"font-bold text-emerald-600",children:a(m.total)})]})]})]})}),e.jsx(d.div,{variants:p,children:e.jsxs(h,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-zinc-800",children:"Storage Location"}),e.jsx(l,{variant:"ghost",size:"icon-sm",onClick:()=>N(!0),children:e.jsx(ge,{className:"w-4 h-4"})})]}),s.rackLocation?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-800",children:s.rackLocation}),e.jsx("p",{className:"text-xs text-blue-600",children:"Rack / Shelf Location"})]})]}):e.jsx("button",{onClick:()=>N(!0),className:"w-full p-3 border-2 border-dashed border-zinc-300 rounded-lg text-zinc-500 hover:border-amber-500 hover:text-amber-600 transition-colors",children:"+ Assign Location"})]})}),e.jsx(d.div,{variants:p,children:e.jsxs(h,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-zinc-800 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[(s.status==="active"||s.status==="overdue")&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",fullWidth:!0,leftIcon:z,onClick:M,children:"Process Renewal"}),e.jsx(l,{variant:"success",fullWidth:!0,leftIcon:b,onClick:L,children:"Process Redemption"})]}),e.jsx(l,{variant:"outline",fullWidth:!0,leftIcon:V,onClick:T,children:"Print Ticket"}),e.jsx(l,{variant:"outline",fullWidth:!0,leftIcon:G,onClick:W,children:"Send WhatsApp"}),e.jsx(l,{variant:"outline",fullWidth:!0,leftIcon:ye,children:"Print Barcode"})]})]})}),e.jsx(d.div,{variants:p,children:e.jsxs(h,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-zinc-800 mb-4",children:"Important Dates"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-zinc-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Created"}),e.jsx("p",{className:"text-sm font-medium",children:o(s.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:f("w-5 h-5",r<=7?"text-red-500":r<=30?"text-amber-500":"text-emerald-500")}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500",children:"Due Date"}),e.jsx("p",{className:"text-sm font-medium",children:o(s.dueDate)}),s.status==="active"&&e.jsx("p",{className:f("text-xs",r<=7?"text-red-500":r<=30?"text-amber-500":"text-emerald-500"),children:r>0?`${r} days remaining`:"Due today!"})]})]})]})]})})]})]}),e.jsx(F,{isOpen:q,onClose:()=>I(!1),title:"Item Photo",size:"lg",children:e.jsx("div",{className:"p-4",children:S&&e.jsx("img",{src:S,alt:"Item",className:"w-full max-h-[70vh] object-contain rounded-lg"})})}),e.jsx(F,{isOpen:X,onClose:()=>N(!1),title:"Set Storage Location",size:"sm",children:e.jsxs("div",{className:"p-5",children:[e.jsx(je,{label:"Rack / Shelf Location",placeholder:"e.g., A1-S3, Rack B Row 2",value:y,onChange:t=>R(t.target.value),leftIcon:U}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx(l,{variant:"outline",fullWidth:!0,onClick:()=>N(!1),children:"Cancel"}),e.jsx(l,{variant:"accent",fullWidth:!0,onClick:Y,children:"Save Location"})]})]})})]})}export{He as default};
