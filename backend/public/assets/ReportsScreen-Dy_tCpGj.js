import{w as Z,u as $,b as I,r as y,g as O,x as ee,k as se,j as e,D as te,P as C,i as k,d as ae,h as R,R as B,q as T,T as M,E as le,S as E}from"./index-o28qtZ4E.js";import{f as d,c as ne}from"./formatters-BhAPqf4o.js";import{P as ie}from"./PageWrapper-D4uzFYGf.js";import{m as n,B as F}from"./proxy-D6mGC7EI.js";import{C as i,S as ce}from"./Modal-7Sg338uS.js";import{B as N}from"./Badge-Br48OPWn.js";import{A as U}from"./activity-9x1LZVm2.js";import{A as V,a as G}from"./arrow-up-right-zIjuM6R2.js";import{D as W}from"./dollar-sign-CXfw5wgV.js";import{G as Y}from"./gem-D6g62J2O.js";import{S as re}from"./scale-DaJuZKuB.js";import{C as de}from"./clock-C6f4WYXs.js";import{D as xe}from"./download-Bqlh6cxb.js";import{P as me}from"./printer-BXY7LAxL.js";const oe=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],he=Z("chart-pie",oe),je=[{id:"overview",label:"Overview",icon:te},{id:"pledges",label:"Pledges",icon:C},{id:"transactions",label:"Transactions",icon:U},{id:"customers",label:"Customers",icon:k}];function Re(){const A=$(),{pledges:m}=I(s=>s.pledges),{customers:o}=I(s=>s.customers),[b,_]=y.useState("overview"),[P,L]=y.useState("month");y.useEffect(()=>{const s=O(E.PLEDGES,[]),c=O(E.CUSTOMERS,[]);A(ee(s)),A(se(c))},[A]);const w=(s,c="createdAt")=>{const h=new Date,j=new Date(h.getFullYear(),h.getMonth(),h.getDate());return s.filter(D=>{const u=new Date(D[c]);switch(P){case"today":return u>=j;case"week":const p=new Date(j);return p.setDate(p.getDate()-7),u>=p;case"month":const g=new Date(j);return g.setMonth(g.getMonth()-1),u>=g;case"year":const v=new Date(j);return v.setFullYear(v.getFullYear()-1),u>=v;default:return!0}})},t=y.useMemo(()=>{const s=w(m),c=m.filter(a=>a.status==="active"||a.status==="overdue"),h=w(m.filter(a=>a.status==="redeemed"),"redeemedAt"),j=s.reduce((a,l)=>a+(l.loanAmount||0),0),D=h.reduce((a,l)=>a+(l.redemptionAmount||0),0),u=m.flatMap(a=>(a.renewals||[]).map(l=>({...l,pledgeId:a.id}))),p=w(u,"date"),g=p.reduce((a,l)=>a+(l.amount||0),0),v=c.reduce((a,l)=>a+(l.loanAmount||0),0),f=c.flatMap(a=>a.items||[]),q=f.reduce((a,l)=>a+(parseFloat(l.weight)||0),0),K=f.reduce((a,l)=>a+(l.netValue||0),0),S=m.filter(a=>a.status==="overdue"),H=S.reduce((a,l)=>a+(l.loanAmount||0),0),J=w(o),Q=f.reduce((a,l)=>{const x=l.purity||"unknown";return a[x]||(a[x]={count:0,weight:0,value:0}),a[x].count++,a[x].weight+=parseFloat(l.weight)||0,a[x].value+=l.netValue||0,a},{}),X=f.reduce((a,l)=>{const x=l.category||"other";return a[x]||(a[x]={count:0,weight:0}),a[x].count++,a[x].weight+=parseFloat(l.weight)||0,a},{});return{newPledges:s.length,totalDisbursed:j,totalCollected:D,renewalCount:p.length,totalRenewalAmount:g,totalOutstanding:v,activePledgeCount:c.length,redeemedCount:h.length,overdueCount:S.length,overdueAmount:H,itemCount:f.length,totalWeight:q,totalItemValue:K,newCustomers:J.length,totalCustomers:o.length,purityBreakdown:Q,categoryBreakdown:X}},[m,o,P]),z={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},r={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e.jsxs(ie,{title:"Reports",subtitle:"View business analytics and reports",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{value:P,onChange:s=>L(s.target.value),options:[{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"},{value:"year",label:"This Year"},{value:"all",label:"All Time"}],className:"w-36"}),e.jsx(F,{variant:"outline",leftIcon:xe,children:"Export"}),e.jsx(F,{variant:"outline",leftIcon:me,children:"Print"})]}),children:[e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:je.map(s=>{const c=s.icon;return e.jsxs("button",{onClick:()=>_(s.id),className:ae("flex items-center gap-2 px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-all",b===s.id?"bg-amber-500 text-white":"bg-white text-zinc-600 hover:bg-zinc-50 border border-zinc-200"),children:[e.jsx(c,{className:"w-4 h-4"}),s.label]},s.id)})}),b==="overview"&&e.jsxs(n.div,{variants:z,initial:"hidden",animate:"visible",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx(R,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs(N,{variant:"success",className:"text-xs",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),"Disbursed"]})]}),e.jsx("p",{className:"text-2xl font-bold text-zinc-800",children:d(t.totalDisbursed)}),e.jsxs("p",{className:"text-sm text-zinc-500",children:[t.newPledges," new pledges"]})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-blue-600"})}),e.jsxs(N,{variant:"info",className:"text-xs",children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),"Collected"]})]}),e.jsx("p",{className:"text-2xl font-bold text-zinc-800",children:d(t.totalCollected)}),e.jsxs("p",{className:"text-sm text-zinc-500",children:[t.redeemedCount," redemptions"]})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-amber-600"})}),e.jsx(N,{variant:"warning",className:"text-xs",children:"Renewals"})]}),e.jsx("p",{className:"text-2xl font-bold text-zinc-800",children:d(t.totalRenewalAmount)}),e.jsxs("p",{className:"text-sm text-zinc-500",children:[t.renewalCount," renewals"]})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-purple-600"})}),e.jsx(N,{variant:"default",className:"text-xs",children:"Customers"})]}),e.jsx("p",{className:"text-2xl font-bold text-zinc-800",children:t.totalCustomers}),e.jsxs("p",{className:"text-sm text-zinc-500",children:["+",t.newCustomers," new"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5",children:[e.jsxs("h3",{className:"font-semibold text-zinc-800 mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-amber-500"}),"Outstanding Portfolio"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-zinc-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-emerald-500"}),e.jsx("span",{className:"text-zinc-600",children:"Active Pledges"})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold",children:t.activePledgeCount})})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-zinc-600",children:"Overdue"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-red-600",children:t.overdueCount}),e.jsx("p",{className:"text-xs text-red-500",children:d(t.overdueAmount)})]})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("span",{className:"font-medium text-amber-800",children:"Total Outstanding"}),e.jsx("span",{className:"text-xl font-bold text-amber-600",children:d(t.totalOutstanding)})]})]})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5",children:[e.jsxs("h3",{className:"font-semibold text-zinc-800 mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-amber-500"}),"Inventory Summary"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-zinc-50 rounded-lg",children:[e.jsx(C,{className:"w-6 h-6 text-zinc-400 mx-auto mb-1"}),e.jsx("p",{className:"text-xl font-bold text-zinc-800",children:t.itemCount}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Items"})]}),e.jsxs("div",{className:"text-center p-3 bg-zinc-50 rounded-lg",children:[e.jsx(re,{className:"w-6 h-6 text-zinc-400 mx-auto mb-1"}),e.jsxs("p",{className:"text-xl font-bold text-zinc-800",children:[t.totalWeight.toFixed(1),"g"]}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Weight"})]}),e.jsxs("div",{className:"text-center p-3 bg-emerald-50 rounded-lg",children:[e.jsx(Y,{className:"w-6 h-6 text-emerald-500 mx-auto mb-1"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:d(t.totalItemValue)}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Value"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-zinc-200",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-500 mb-2",children:"By Purity"}),e.jsx("div",{className:"space-y-2",children:Object.entries(t.purityBreakdown).map(([s,c])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-zinc-600",children:[s," Gold"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-zinc-400",children:[c.count," items"]}),e.jsxs("span",{className:"font-medium",children:[c.weight.toFixed(1),"g"]})]})]},s))})]})]})]})})]}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5",children:[e.jsxs("h3",{className:"font-semibold text-zinc-800 mb-4 flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-amber-500"}),"Items by Category"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:Object.entries(t.categoryBreakdown).map(([s,c])=>e.jsxs("div",{className:"p-4 bg-zinc-50 rounded-xl text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-zinc-800",children:c.count}),e.jsx("p",{className:"text-sm text-zinc-500 capitalize",children:s}),e.jsxs("p",{className:"text-xs text-zinc-400",children:[c.weight.toFixed(1),"g"]})]},s))})]})})]}),b==="pledges"&&e.jsxs(n.div,{variants:z,initial:"hidden",animate:"visible",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-4 text-center",children:[e.jsx(C,{className:"w-8 h-8 text-amber-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-zinc-800",children:t.newPledges}),e.jsx("p",{className:"text-sm text-zinc-500",children:"New Pledges"})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-4 text-center",children:[e.jsx(T,{className:"w-8 h-8 text-emerald-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:t.activePledgeCount}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Active"})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-4 text-center",children:[e.jsx(M,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.overdueCount}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Overdue"})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-4 text-center",children:[e.jsx(W,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.redeemedCount}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Redeemed"})]})})]}),e.jsxs(i,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-zinc-800 mb-4",children:"Recent Pledges"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-zinc-200",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-zinc-600",children:"Pledge ID"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-zinc-600",children:"Customer"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-zinc-600",children:"Amount"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-zinc-600",children:"Date"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-zinc-600",children:"Status"})]})}),e.jsx("tbody",{children:m.slice(0,10).map(s=>e.jsxs("tr",{className:"border-b border-zinc-100",children:[e.jsx("td",{className:"p-3 font-mono text-sm",children:s.id}),e.jsx("td",{className:"p-3 text-sm",children:s.customerName}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:d(s.loanAmount)}),e.jsx("td",{className:"p-3 text-sm text-zinc-500",children:ne(s.createdAt)}),e.jsx("td",{className:"p-3",children:e.jsx(N,{variant:s.status==="active"?"success":s.status==="overdue"?"error":s.status==="redeemed"?"info":"default",children:s.status})})]},s.id))})]})})]})]}),b==="transactions"&&e.jsxs(n.div,{variants:z,initial:"hidden",animate:"visible",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5 bg-gradient-to-br from-emerald-500 to-emerald-600 text-white",children:[e.jsx(R,{className:"w-8 h-8 mb-3 opacity-80"}),e.jsx("p",{className:"text-emerald-100 text-sm",children:"Money Out (Disbursed)"}),e.jsx("p",{className:"text-2xl font-bold",children:d(t.totalDisbursed)}),e.jsxs("p",{className:"text-emerald-200 text-sm mt-1",children:[t.newPledges," transactions"]})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5 bg-gradient-to-br from-blue-500 to-blue-600 text-white",children:[e.jsx(le,{className:"w-8 h-8 mb-3 opacity-80"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Money In (Collected)"}),e.jsx("p",{className:"text-2xl font-bold",children:d(t.totalCollected+t.totalRenewalAmount)}),e.jsxs("p",{className:"text-blue-200 text-sm mt-1",children:[t.redeemedCount+t.renewalCount," transactions"]})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-5 bg-gradient-to-br from-amber-500 to-amber-600 text-white",children:[e.jsx(U,{className:"w-8 h-8 mb-3 opacity-80"}),e.jsx("p",{className:"text-amber-100 text-sm",children:"Net Cash Flow"}),e.jsx("p",{className:"text-2xl font-bold",children:d(t.totalCollected+t.totalRenewalAmount-t.totalDisbursed)}),e.jsx("p",{className:"text-amber-200 text-sm mt-1",children:t.totalCollected+t.totalRenewalAmount>=t.totalDisbursed?"Positive":"Negative"})]})})]}),e.jsxs(i,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-zinc-800 mb-4",children:"Transaction Breakdown"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-zinc-700",children:"New Pledges (Cash Out)"})]}),e.jsxs("span",{className:"font-semibold text-red-600",children:["-",d(t.totalDisbursed)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-emerald-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-emerald-500"}),e.jsx("span",{className:"text-zinc-700",children:"Redemptions (Cash In)"})]}),e.jsxs("span",{className:"font-semibold text-emerald-600",children:["+",d(t.totalCollected)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-zinc-700",children:"Renewals (Interest In)"})]}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["+",d(t.totalRenewalAmount)]})]})]})]})]}),b==="customers"&&e.jsxs(n.div,{variants:z,initial:"hidden",animate:"visible",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-4 text-center",children:[e.jsx(k,{className:"w-8 h-8 text-purple-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-zinc-800",children:t.totalCustomers}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Total Customers"})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-4 text-center",children:[e.jsx(R,{className:"w-8 h-8 text-emerald-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:t.newCustomers}),e.jsx("p",{className:"text-sm text-zinc-500",children:"New This Period"})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-4 text-center",children:[e.jsx(T,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.filter(s=>s.activePledges>0).length}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Active Customers"})]})}),e.jsx(n.div,{variants:r,children:e.jsxs(i,{className:"p-4 text-center",children:[e.jsx(de,{className:"w-8 h-8 text-zinc-400 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-zinc-600",children:o.filter(s=>!s.activePledges||s.activePledges===0).length}),e.jsx("p",{className:"text-sm text-zinc-500",children:"Inactive"})]})})]}),e.jsxs(i,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-zinc-800 mb-4",children:"Top Customers by Total Amount"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-zinc-200",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-zinc-600",children:"#"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-zinc-600",children:"Customer"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-zinc-600",children:"Active"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-zinc-600",children:"Total Pledges"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-zinc-600",children:"Total Amount"})]})}),e.jsx("tbody",{children:o.sort((s,c)=>(c.totalAmount||0)-(s.totalAmount||0)).slice(0,10).map((s,c)=>e.jsxs("tr",{className:"border-b border-zinc-100",children:[e.jsx("td",{className:"p-3 text-sm text-zinc-400",children:c+1}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white text-sm font-medium",children:s.name?.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-zinc-800",children:s.name}),e.jsx("p",{className:"text-xs text-zinc-400",children:s.id})]})]})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(N,{variant:s.activePledges>0?"success":"default",children:s.activePledges||0})}),e.jsx("td",{className:"p-3 text-center text-sm",children:s.totalPledges||0}),e.jsx("td",{className:"p-3 text-right font-semibold text-emerald-600",children:d(s.totalAmount||0)})]},s.id))})]})})]})]})]})}export{Re as default};
